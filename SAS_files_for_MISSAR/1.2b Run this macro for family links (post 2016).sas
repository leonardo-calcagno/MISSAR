<<<<<<< HEAD
/*The logic behind this macro is laid out in Appendix I of the thesis*/

/*Macro for putting at zero missing values*/
 %Macro M_Zero (ds) ;
     data &ds. (drop=_i);
          set &ds. ;
          array A_VarNum[*] _NUMERIC_ ;     

          do _i=1 to dim( A_VarNum ) ;
          If A_VarNum (_i)=. then A_VarNum (_i)=0 ;
     End ;
   run ;
%Mend ; 

%macro family_links_and_id_post_2016 (library,indata,quarter,outdata_1,outdata_2,outdata_3,period,period_2);  
dm 'clear log';
dm 'odsresults; clear';  
options nofmterr; 
data &library..&indata.; 
set &library..&indata.; 
	id=person; 
run; 
proc sort data=&library..&indata.; 
	by id; 
run; 
data &library..temporary_base; 
set &library..&indata.; 
	where trimestre=&quarter.; 
 if ch03=01 then hhstate=1; 
 if ch03=02 then hhstate=2;
 if ch03=03 then hhstate=3; 
 if ch03=04 then hhstate=4; 
 if ch03=05 then hhstate=5; 
 if ch03=06 then hhstate=6; 
 if ch03=07 then hhstate=7; 
 if ch03=08 then hhstate=8; 
 if ch03=09 then hhstate=9; 
 if ch03=10 then hhstate=10;  
 if ch07=1 then marital_status=1; 
 if ch07=2 then marital_status=2; 
 if ch07=3 then marital_status=3; 
 if ch07=4 then marital_status=4; 
 if ch07=5 then marital_status=5;
 run; 
 

data  &library..temporary_base; 
set  &library..temporary_base; 
	by id; 
		temp_id+1;
		id_short=temp_id-1; 
	drop temp_id;
run; 
 data &library..temporary_id; 
 set &library..temporary_base; 
 ruN; 
data &library..indata_bis; 
 set &library..temporary_base; 
 keep period household id hhstate marital_status ch04 ano4 trimestre;
 run; 

 data &library..temporary_base; 
 set &library..temporary_base; 
keep household componente hhstate ch04 marital_status;
run; 
data &library..temporary_base; 
set &library..temporary_base; 
idza_1=cats(household,1); idzb_1=cats(household,2);
idza_2=cats(household,1);idzb_2=cats(household,2);  
idzalpha_3=cats(household,2);  idza_3=cats(household,3);idzb_3=cats(household,4);idzc_3=cats(household,5);idzd_3=cats(household,6);idze_3=cats(household,7);idzf_3=cats(household,8);idzg_3=cats(household,9);idzh_3=cats(household,10);idzi_3=cats(household,11);idzj_3=cats(household,12);idzk_3=cats(household,13);idzl_3=cats(household,14);idzm_3=cats(household,15);idzn_3=cats(household,16);

idzalpha_4=cats(household,2); idza_4=cats(household,3);idzb_4=cats(household,4);idzc_4=cats(household,5);idzd_4=cats(household,6);idze_4=cats(household,7);idzf_4=cats(household,8);idzg_4=cats(household,9);idzh_4=cats(household,10);idzi_4=cats(household,11);idzj_4=cats(household,12);idzk_4=cats(household,14);idzl_4=cats(household,14);idzm_4=cats(household,15);idzn_4=cats(household,16);idzo_4=cats(household,17);idzp_4=cats(household,18);
idzalpha_5=cats(household,2);idza_5=cats(household,3);idzb_5=cats(household,5);idzc_5=cats(household,5);idzd_5=cats(household,6);idze_5=cats(household,7);idzf_5=cats(household,8);idzg_5=cats(household,9);idzh_5=cats(household,10);idzi_5=cats(household,11);idzj_5=cats(household,12);idzk_5=cats(household,15);idzl_5=cats(household,15);idzm_5=cats(household,15);idzn_5=cats(household,16);idzo_5=cats(household,17);idzp_5=cats(household,18);idzq_5=cats(household,19);idzr_5=cats(household,20);idzs_5=cats(household,21);idzt_5=cats(household,22);
idzalpha_6=cats(household,2);idza_6=cats(household,3);idzb_6=cats(household,5);idzc_6=cats(household,5);idzd_6=cats(household,6);idze_6=cats(household,7);idzf_6=cats(household,8);idzg_6=cats(household,9);idzh_6=cats(household,10);idzi_6=cats(household,11);idzj_6=cats(household,12);idzk_6=cats(household,15);idzl_6=cats(household,15);idzm_6=cats(household,15);idzn_6=cats(household,16);idzo_6=cats(household,17);idzp_6=cats(household,18);idzq_6=cats(household,19);idzr_6=cats(household,20);idzs_6=cats(household,21);idzt_6=cats(household,22);
idzalpha_7=cats(household,2);idza_7=cats(household,3);idzb_7=cats(household,5);idzc_7=cats(household,5);idzd_7=cats(household,6);idze_7=cats(household,7);idzf_7=cats(household,8);idzg_7=cats(household,9);idzh_7=cats(household,10);idzi_7=cats(household,11);idzj_7=cats(household,12);idzk_7=cats(household,15);idzl_7=cats(household,15);idzm_7=cats(household,15);idzn_7=cats(household,16);idzo_7=cats(household,17);idzp_7=cats(household,18);idzq_7=cats(household,19);idzr_7=cats(household,20);idzs_7=cats(household,21);idzt_7=cats(household,22);
idzalpha_8=cats(household,2);idza_8=cats(household,3);idzb_8=cats(household,5);idzc_8=cats(household,5);idzd_8=cats(household,6);idze_8=cats(household,7);idzf_8=cats(household,8);idzg_8=cats(household,9);idzh_8=cats(household,10);idzi_8=cats(household,11);idzj_8=cats(household,12);idzk_8=cats(household,15);idzl_8=cats(household,15);idzm_8=cats(household,15);idzn_8=cats(household,16);idzo_8=cats(household,17);idzp_8=cats(household,18);idzq_8=cats(household,19);idzr_8=cats(household,20);idzs_8=cats(household,21);idzt_8=cats(household,22);
idzalpha_9=cats(household,2);idza_9=cats(household,3);idzb_9=cats(household,5);idzc_9=cats(household,5);idzd_9=cats(household,6);idze_9=cats(household,7);idzf_9=cats(household,8);idzg_9=cats(household,9);idzh_9=cats(household,10);idzi_9=cats(household,11);idzj_9=cats(household,12);idzk_9=cats(household,15);idzl_9=cats(household,15);idzm_9=cats(household,15);idzn_9=cats(household,16);idzo_9=cats(household,17);idzp_9=cats(household,18);idzq_9=cats(household,19);idzr_9=cats(household,20);idzs_9=cats(household,21);idzt_9=cats(household,22);
idzalpha_10=cats(household,2);idza_10=cats(household,3);idzb_10=cats(household,5);idzc_10=cats(household,5);idzd_10=cats(household,6);idze_10=cats(household,7);idzf_10=cats(household,8);idzg_10=cats(household,9);idzh_10=cats(household,10);idzi_10=cats(household,11);idzj_10=cats(household,12);idzk_10=cats(household,15);idzl_10=cats(household,15);idzm_10=cats(household,15);idzn_10=cats(household,16);idzo_10=cats(household,17);idzp_10=cats(household,18);idzq_10=cats(household,19);idzr_10=cats(household,20);idzs_10=cats(household,21);idzt_10=cats(household,22);
idz51=cats(household,51);
idz71=cats(household,71);  
 ida_1=cats(household,1);idb_1=cats(household,2);
ida_2=cats(household,1);idb_2=cats(household,2);  
idalpha_3=cats(household,2); ida_3=cats(household,3);idb_3=cats(household,4);idc_3=cats(household,5);idd_3=cats(household,6);ide_3=cats(household,7);idf_3=cats(household,8);idg_3=cats(household,9);idh_3=cats(household,10);idi_3=cats(household,11);idj_3=cats(household,12);idk_3=cats(household,13);idl_3=cats(household,14);idm_3=cats(household,15);idn_3=cats(household,16);
idalpha_4=cats(household,2);
ida_4=cats(household,3);idb_4=cats(household,4);idc_4=cats(household,5);idd_4=cats(household,6);ide_4=cats(household,7);idf_4=cats(household,8);idg_4=cats(household,9);idh_4=cats(household,10);idi_4=cats(household,11);idj_4=cats(household,12);idk_4=cats(household,14);idl_4=cats(household,14);idm_4=cats(household,15);idn_4=cats(household,16);ido_4=cats(household,17);idp_4=cats(household,18);
idalpha_5=cats(household,2);
ida_5=cats(household,3);idb_5=cats(household,5);idc_5=cats(household,5);idd_5=cats(household,6);ide_5=cats(household,7);idf_5=cats(household,8);idg_5=cats(household,9);idh_5=cats(household,10);idi_5=cats(household,11);idj_5=cats(household,12);idk_5=cats(household,15);idl_5=cats(household,15);idm_5=cats(household,15);idn_5=cats(household,16);ido_5=cats(household,17);idp_5=cats(household,18);idq_5=cats(household,19);idr_5=cats(household,20);ids_5=cats(household,21);idt_5=cats(household,22);
idalpha_6=cats(household,2);
ida_6=cats(household,3);idb_6=cats(household,5);idc_6=cats(household,5);idd_6=cats(household,6);ide_6=cats(household,7);idf_6=cats(household,8);idg_6=cats(household,9);idh_6=cats(household,10);idi_6=cats(household,11);idj_6=cats(household,12);idk_6=cats(household,15);idl_6=cats(household,15);idm_6=cats(household,15);idn_6=cats(household,16);ido_6=cats(household,17);idp_6=cats(household,18);idq_6=cats(household,19);idr_6=cats(household,20);ids_6=cats(household,21);idt_6=cats(household,22);
idalpha_7=cats(household,2); 
ida_7=cats(household,3);idb_7=cats(household,5);idc_7=cats(household,5);idd_7=cats(household,6);ide_7=cats(household,7);idf_7=cats(household,8);idg_7=cats(household,9);idh_7=cats(household,10);idi_7=cats(household,11);idj_7=cats(household,12);idk_7=cats(household,15);idl_7=cats(household,15);idm_7=cats(household,15);idn_7=cats(household,16);ido_7=cats(household,17);idp_7=cats(household,18);idq_7=cats(household,19);idr_7=cats(household,20);ids_7=cats(household,21);idt_7=cats(household,22);
idalpha_8=cats(household,2); 
ida_8=cats(household,3);idb_8=cats(household,5);idc_8=cats(household,5);idd_8=cats(household,6);ide_8=cats(household,7);idf_8=cats(household,8);idg_8=cats(household,9);idh_8=cats(household,10);idi_8=cats(household,11);idj_8=cats(household,12);idk_8=cats(household,15);idl_8=cats(household,15);idm_8=cats(household,15);idn_8=cats(household,16);ido_8=cats(household,17);idp_8=cats(household,18);idq_8=cats(household,19);idr_8=cats(household,20);ids_8=cats(household,21);idt_8=cats(household,22);
idalpha_9=cats(household,2); 
ida_9=cats(household,3);idb_9=cats(household,5);idc_9=cats(household,5);idd_9=cats(household,6);ide_9=cats(household,7);idf_9=cats(household,8);idg_9=cats(household,9);idh_9=cats(household,10);idi_9=cats(household,11);idj_9=cats(household,12);idk_9=cats(household,15);idl_9=cats(household,15);idm_9=cats(household,15);idn_9=cats(household,16);ido_9=cats(household,17);idp_9=cats(household,18);idq_9=cats(household,19);idr_9=cats(household,20);ids_9=cats(household,21);idt_9=cats(household,22);
idalpha_10=cats(household,2); 
ida_10=cats(household,3);idb_10=cats(household,5);idc_10=cats(household,5);idd_10=cats(household,6);ide_10=cats(household,7);idf_10=cats(household,8);idg_10=cats(household,9);idh_10=cats(household,10);idi_10=cats(household,11);idj_10=cats(household,12);idk_10=cats(household,15);idl_10=cats(household,15);idm_10=cats(household,15);idn_10=cats(household,16);ido_10=cats(household,17);idp_10=cats(household,18);idq_10=cats(household,19);idr_10=cats(household,20);ids_10=cats(household,21);idt_10=cats(household,22);
id51=cats(household,51);
id71=cats(household,71);  
run; 

 data &library..id_component1; 
set &library..temporary_base (where=((hhstate=1)&(componente=1)&(ch04=1)));
keep household ida_1 ; 
run;  

data &library..id_component2; 
set &library..temporary_base (where=((hhstate=1)&(componente=2)&(ch04=1)));
keep household idb_1 ; 
run;  
data &library..id_componentz1; 
set &library..temporary_base (where=((hhstate=1)&(componente=1)&(ch04=2)));
keep household idza_1 ; 
run;  

data &library..id_componentz2; 
set &library..temporary_base (where=((hhstate=1)&(componente=2)&(ch04=2)));
keep household idzb_1 ; 
run;  
proc sort data=&library..indata_bis; 
	by household; 
run; 
data &library..hh_position_1; 
merge &library..indata_bis &library..id_component1 &library..id_component2 &library..id_componentz1 &library..id_componentz2; 
by household; 
run; 
data &library..hh_position_1; 
set &library..hh_position_1; 
if (hhstate=1) &(componente=1)&(ch04=1) then ida_1='1';
if (hhstate=1) &(componente=2)&(ch04=1) then idb_1='1'; 
if (hhstate=1) &(componente=1)&(ch04=2) then idza_1='1';
if (hhstate=1) &(componente=2)&(ch04=2) then idzb_1='1'; 
if missing(ida_1) then ida_1='0'; 
if missing(idb_1) then idb_1='0'; 
if (ida_1^='0')&(ida_1^='1') then jefe_id=ida_1; 
if (idb_1^='0')&(idb_1^='1') then jefe_id=idb_1; 
if hhstate=1 then jefe_id='1'; 

if missing(ida_1) then ida_1='0'; 
if missing(idb_1) then idb_1='0'; 

if missing(idza_1) then idza_1='0'; 
if missing(idzb_1) then idzb_1='0'; 
if (idza_1^='0')&(idza_1^='1') then jefe_id=idza_1; 
if (idzb_1^='0')&(idzb_1^='1') then jefe_id=idzb_1; 
if hhstate=1 then jefe_id='1'; 

run;  
/*Voilà: on a défini la variable jefe_id. ´Nous on veut in fine avoir la variable mother_id. 
Concrètement, la mère peut se trouver en hhid=1 | hhid=2 | hhid=3 |hhid=4 |hhid=6 |hhid=7. 
Pour l'instant on va lancer aussi la variable partenaire_id.;*/
data &library..id_component1; 
set &library..temporary_base (where=((hhstate=2)&(componente=1)&(ch04=1)));
keep household ida_2 ; 
run;  

data &library..id_component2; 
set &library..temporary_base (where=((hhstate=2)&(componente=2)&(ch04=1)));
keep household idb_2 ; 
run;  
data &library..id_componentz1; 
set &library..temporary_base (where=((hhstate=2)&(componente=1)&(ch04=2)));
keep household idza_2 ; 
run;  

data &library..id_componentz2; 
set &library..temporary_base (where=((hhstate=2)&(componente=2)&(ch04=2)));
keep household idzb_2 ; 
run;  

data &library..hh_position_2; 
merge &library..indata_bis &library..id_component1 &library..id_component2 &library..id_componentz1 &library..id_componentz2; 
by household; 
run; 
data &library..hh_position_2; 
set &library..hh_position_2; 
if (hhstate=2) &(componente=1)&(ch04=1) then ida_2='1';
if (hhstate=2) &(componente=2)&(ch04=1) then idb_2='1'; 
if (hhstate=2) &(componente=1)&(ch04=2) then idza_2='1';
if (hhstate=2) &(componente=2)&(ch04=2) then idzb_2='1';
if missing(ida_2) then ida_2='0'; 
if missing(idb_2) then idb_2='0'; 
if (ida_2^='0')&(ida_2^='1') then partenaire_id=ida_2; 
if (idb_2^='0')&(idb_2^='1') then partenaire_id=idb_2; 
if hhstate=2 then partenaire_id='1';  
if missing(partenaire_id) then partenaire_id='0';
 
if missing(idza_2) then idza_2='0'; 
if missing(idzb_2) then idzb_2='0'; 
if (idza_2^='0')&(idza_2^='1') then partenaire_id=idza_2; 
if (idzb_2^='0')&(idzb_2^='1') then partenaire_id=idzb_2; 
if hhstate=2 then partenaire_id='1';  
if missing(partenaire_id) then partenaire_id='0'; 
run;  
/*This macro makes missing values equal 0*/
 %Macro M_Zero (ds) ;
     data &ds. (drop=_i);
          set &ds. ;
          array A_VarNum[*] _NUMERIC_ ;     

          do _i=1 to dim( A_VarNum ) ;
          If A_VarNum (_i)=. then A_VarNum (_i)=0 ;
     End ;
   run ;
%Mend ; 


%macro hhstate2(hhstate);

data &library..id_componentalpha; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=2)&(ch04=1)));
keep household idalpha_&hhstate. marital_status; 
run;  
data &library..id_componentalpha; 
set &library..id_componentalpha; 
rename marital_status=idalpha_civ_&hhstate.; 
ruN; 
data &library..id_componenta; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=3)&(ch04=1)));
keep household ida_&hhstate. marital_status; 
run;  
data &library..id_componenta; 
set &library..id_componenta; 
rename marital_status=ida_civ_&hhstate.; 
ruN; 
data &library..id_componentb; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=4)&(ch04=1)));
keep household idb_&hhstate. marital_status; 
run;  
data &library..id_componentb; 
set &library..id_componentb; 
rename marital_status=idb_civ_&hhstate.; 
ruN; 
data &library..id_componentc; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=5)&(ch04=1)));
keep household idc_&hhstate. marital_status; 
run;  
data &library..id_componentc; 
set &library..id_componentc; 
rename marital_status=idc_civ_&hhstate.; 
ruN; 
data &library..id_componentd; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=6)&(ch04=1)));
keep household idd_&hhstate. marital_status; 
run;  
data &library..id_componentd; 
set &library..id_componentd; 
rename marital_status=idd_civ_&hhstate.; 
ruN; 
data &library..id_componente; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=7)&(ch04=1)));
keep household ide_&hhstate. marital_status; 
run;  
data &library..id_componente; 
set &library..id_componente; 
rename marital_status=ide_civ_&hhstate.; 
ruN; 
data &library..id_componentf; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=8)&(ch04=1)));
keep household idf_&hhstate. marital_status; 
run;  
data &library..id_componentf; 
set &library..id_componentf; 
rename marital_status=idf_civ_&hhstate.; 
ruN; 
data &library..id_componentg; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=9)&(ch04=1)));
keep household idg_&hhstate. marital_status; 
run;  
data &library..id_componentg; 
set &library..id_componentg; 
rename marital_status=idg_civ_&hhstate.; 
ruN; 
data &library..id_componenth; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=10)&(ch04=1)));
keep household idh_&hhstate. marital_status; 
run;  
data &library..id_componenth; 
set &library..id_componenth; 
rename marital_status=idh_civ_&hhstate.; 
ruN; 
data &library..id_componenti; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=11)&(ch04=1)));
keep household idi_&hhstate. marital_status; 
run;  
data &library..id_componenti; 
set &library..id_componenti; 
rename marital_status=idi_civ_&hhstate.; 
ruN; 
data &library..id_componentj; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=12)&(ch04=1)));
keep household idj_&hhstate. marital_status; 
run;  
data &library..id_componentj; 
set &library..id_componentj; 
rename marital_status=idj_civ_&hhstate.; 
ruN; 
data &library..id_componentk; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=13)&(ch04=1)));
keep household idk_&hhstate. marital_status; 
run;  
data &library..id_componentk; 
set &library..id_componentk; 
rename marital_status=idk_civ_&hhstate.; 
ruN; 
data &library..id_componentl; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=14)&(ch04=1)));
keep household idl_&hhstate. marital_status; 
run;  
data &library..id_componentl; 
set &library..id_componentl; 
rename marital_status=idl_civ_&hhstate.; 
ruN; 
data &library..id_componentm; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=15)&(ch04=1)));
keep household idm_&hhstate. marital_status; 
run;  
data &library..id_componentm; 
set &library..id_componentm; 
rename marital_status=idm_civ_&hhstate.; 
ruN; 

data &library..id_componentn; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=16)&(ch04=1)));
keep household idn_&hhstate. marital_status; 
run;  
data &library..id_componentn; 
set &library..id_componentn; 
rename marital_status=idn_civ_&hhstate.; 
ruN; 
data &library..id_componento; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=17)&(ch04=1)));
keep household ido_&hhstate. marital_status; 
run;  
data &library..id_componento; 
set &library..id_componento; 
rename marital_status=ido_civ_&hhstate.; 
ruN; 
data &library..id_componentp; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=18)&(ch04=1)));
keep household idp_&hhstate. marital_status; 
run; 
data &library..id_componentp; 
set &library..id_componentp; 
rename marital_status=idp_civ_&hhstate.; 
ruN; 
data &library..id_componentq; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=19)&(ch04=1)));
keep household idq_&hhstate. marital_status; 
run;  
data &library..id_componentq; 
set &library..id_componentq; 
rename marital_status=idq_civ_&hhstate.; 
ruN; 
data &library..id_componentr; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=20)&(ch04=1)));
keep household idr_&hhstate. marital_status; 
run;  
data &library..id_componentr; 
set &library..id_componentr; 
rename marital_status=idr_civ_&hhstate.; 
ruN; 
data &library..id_components; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=21)&(ch04=1)));
keep household ids_&hhstate. marital_status; 
run;  
data &library..id_components; 
set &library..id_components; 
rename marital_status=ids_civ_&hhstate.; 
ruN; 
data &library..id_componentt; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=22)&(ch04=1)));
keep household idt_&hhstate. marital_status; 
run;  
data &library..id_componentt; 
set &library..id_componentt; 
rename marital_status=idt_civ_&hhstate.; 
ruN; 
data &library..id_componentu; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=23)&(ch04=1)));
keep household idu_&hhstate. marital_status; 
run;  
data &library..id_componentu; 
set &library..id_componentu; 
rename marital_status=idu_civ_&hhstate.; 
ruN; 

data &library..id_componentzalpha; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=2)&(ch04=2)));
keep household idzalpha_&hhstate. marital_status; 
run;  
data &library..id_componentzalpha; 
set &library..id_componentzalpha; 
rename marital_status=idzalpha_civ_&hhstate.; 
ruN; 

data &library..id_componentza; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=3)&(ch04=2)));
keep household idza_&hhstate. marital_status; 
run;  
data &library..id_componentza; 
set &library..id_componentza; 
rename marital_status=idza_civ_&hhstate.; 
ruN; 

data &library..id_componentzb; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=4)&(ch04=2)));
keep household idzb_&hhstate. marital_status; 
run;  
data &library..id_componentzb; 
set &library..id_componentzb; 
rename marital_status=idzb_civ_&hhstate.; 
ruN; 
data &library..id_componentzc; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=5)&(ch04=2)));
keep household idzc_&hhstate. marital_status; 
run;  
data &library..id_componentzc; 
set &library..id_componentzc; 
rename marital_status=idzc_civ_&hhstate.; 
ruN; 
data &library..id_componentzd; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=6)&(ch04=2)));
keep household idzd_&hhstate. marital_status; 
run;  
data &library..id_componentzd; 
set &library..id_componentzd; 
rename marital_status=idzd_civ_&hhstate.; 
ruN; 
data &library..id_componentze; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=7)&(ch04=2)));
keep household idze_&hhstate. marital_status; 
run;  
data &library..id_componentze; 
set &library..id_componentze; 
rename marital_status=idze_civ_&hhstate.; 
ruN; 
data &library..id_componentzf; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=8)&(ch04=2)));
keep household idzf_&hhstate. marital_status; 
run;  
data &library..id_componentzf; 
set &library..id_componentzf; 
rename marital_status=idzf_civ_&hhstate.; 
ruN; 
data &library..id_componentzg; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=9)&(ch04=2)));
keep household idzg_&hhstate. marital_status; 
run;  
data &library..id_componentzg; 
set &library..id_componentzg; 
rename marital_status=idzg_civ_&hhstate.; 
ruN; 
data &library..id_componentzh; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=10)&(ch04=2)));
keep household idzh_&hhstate. marital_status; 
run;  
data &library..id_componentzh; 
set &library..id_componentzh; 
rename marital_status=idzh_civ_&hhstate.; 
ruN; 
data &library..id_componentzi; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=11)&(ch04=2)));
keep household idzi_&hhstate. marital_status; 
run;  
data &library..id_componentzi; 
set &library..id_componentzi; 
rename marital_status=idzi_civ_&hhstate.; 
ruN; 
data &library..id_componentzj; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=12)&(ch04=2)));
keep household idzj_&hhstate. marital_status; 
run;  
data &library..id_componentzj; 
set &library..id_componentzj; 
rename marital_status=idzj_civ_&hhstate.; 
ruN; 
data &library..id_componentzk; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=13)&(ch04=2)));
keep household idzk_&hhstate. marital_status; 
run;  
data &library..id_componentzk; 
set &library..id_componentzk; 
rename marital_status=idzk_civ_&hhstate.; 
ruN; 
data &library..id_componentzl; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=14)&(ch04=2)));
keep household idzl_&hhstate. marital_status; 
run;  
data &library..id_componentzl; 
set &library..id_componentzl; 
rename marital_status=idzl_civ_&hhstate.; 
ruN; 
data &library..id_componentzm; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=15)&(ch04=2)));
keep household idzm_&hhstate. marital_status; 
run;  

data &library..id_componentzm; 
set &library..id_componentzm; 
rename marital_status=idzm_civ_&hhstate.; 
ruN; 
data &library..id_componentzn; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=16)&(ch04=2)));
keep household idzn_&hhstate. marital_status; 
run;  
data &library..id_componentzn; 
set &library..id_componentzn; 
rename marital_status=idzn_civ_&hhstate.; 
ruN; 
data &library..id_componentzo; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=17)&(ch04=2)));
keep household idzo_&hhstate. marital_status; 
run;  
data &library..id_componentzo; 
set &library..id_componentzo; 
rename marital_status=idzo_civ_&hhstate.; 
ruN; 
data &library..id_componentzp; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=18)&(ch04=2)));
keep household idzp_&hhstate. marital_status; 
run; 
data &library..id_componentzp; 
set &library..id_componentzp; 
rename marital_status=idzp_civ_&hhstate.; 
ruN; 
data &library..id_componentzq; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=19)&(ch04=2)));
keep household idzq_&hhstate. marital_status; 
run;  
data &library..id_componentzq; 
set &library..id_componentzq; 
rename marital_status=idzq_civ_&hhstate.; 
ruN; 
data &library..id_componentzr; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=20)&(ch04=2)));
keep household idzr_&hhstate. marital_status; 
run;  
data &library..id_componentzr; 
set &library..id_componentzr; 
rename marital_status=idzr_civ_&hhstate.; 
ruN; 
data &library..id_componentzs; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=21)&(ch04=2)));
keep household idzs_&hhstate. marital_status; 
run;  
data &library..id_componentzs; 
set &library..id_componentzs; 
rename marital_status=idzs_civ_&hhstate.; 
ruN; 
data &library..id_componentzt; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=22)&(ch04=2)));
keep household idzt_&hhstate. marital_status; 
run;  
data &library..id_componentzt; 
set &library..id_componentzt; 
rename marital_status=idzt_civ_&hhstate.; 
ruN; 
data &library..id_componentzu; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=23)&(ch04=2)));
keep household idzu_&hhstate. marital_status; 
run;  
data &library..id_componentzu; 
set &library..id_componentzu; 
rename marital_status=idzu_civ_&hhstate.; 
ruN; 


data &library..hh_position_&hhstate.; 
merge &library..indata_bis &library..id_componentalpha &library..id_componenta &library..id_componentb &library..id_componentc &library..id_componentd 
&library..id_componente &library..id_componentf &library..id_componentg &library..id_componenth &library..id_componenti &library..id_componentj 
&library..id_componentk &library..id_componentl &library..id_componentm &library..id_componentn &library..id_componento &library..id_componentp &library..id_componentq  
&library..id_componentr &library..id_components &library..id_componentt &library..id_componentu &library..id_componentzalpha
&library..id_componentza &library..id_componentzb &library..id_componentzc &library..id_componentzd 
&library..id_componentze &library..id_componentzf &library..id_componentzg &library..id_componentzh &library..id_componentzi &library..id_componentzj 
&library..id_componentzk &library..id_componentzl &library..id_componentzm &library..id_componentzn &library..id_componentzo &library..id_componentzp &library..id_componentzq  
&library..id_componentzr &library..id_componentzs &library..id_componentzt &library..id_componentzu;
by household; 
run; 
data &library..hh_position_&hhstate.; 
set &library..hh_position_&hhstate.; 
if (hhstate=&hhstate.) &(componente=2)&(ch04=1) then idalpha_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=3)&(ch04=1) then ida_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=4)&(ch04=1) then idb_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=5)&(ch04=1) then idc_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=6)&(ch04=1) then idd_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=7)&(ch04=1) then ide_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=8)&(ch04=1) then idf_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=9)&(ch04=1) then idg_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=10)&(ch04=1) then idh_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=11)&(ch04=1) then idi_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=12)&(ch04=1) then idj_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=13)&(ch04=1) then idk_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=14)&(ch04=1) then idl_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=15)&(ch04=1) then idm_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=16)&(ch04=1) then idn_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=17)&(ch04=1) then ido_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=18)&(ch04=1) then idp_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=19)&(ch04=1) then idq_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=20)&(ch04=1) then idr_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=21)&(ch04=1) then ids_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=22)&(ch04=1) then idt_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=23)&(ch04=1) then idu_&hhstate.='1';

 if (hhstate=&hhstate.) &(componente=2)&(ch04=2) then idzalpha_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=3)&(ch04=2) then idza_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=4)&(ch04=2) then idzb_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=5)&(ch04=2) then idzc_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=6)&(ch04=2) then idzd_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=7)&(ch04=2) then idze_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=8)&(ch04=2) then idzf_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=9)&(ch04=2) then idzg_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=10)&(ch04=2) then idzh_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=11)&(ch04=2) then idzi_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=12)&(ch04=2) then idzj_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=13)&(ch04=2) then idzk_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=14)&(ch04=2) then idzl_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=15)&(ch04=2) then idzm_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=16)&(ch04=2) then idzn_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=17)&(ch04=2) then idzo_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=18)&(ch04=2) then idzp_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=19)&(ch04=2) then idzq_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=20)&(ch04=2) then idzr_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=21)&(ch04=2) then idzs_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=22)&(ch04=2) then idzt_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=23)&(ch04=2) then idzu_&hhstate.='1';
if missing(idalpha_&hhstate.) then idalpha_&hhstate.='0'; 
if (idalpha_&hhstate.^='0')&(idalpha_&hhstate.^='1') then id_&hhstate.=idalpha_&hhstate.; 
if missing(ida_&hhstate.) then ida_&hhstate.='0'; 
if (ida_&hhstate.^='0')&(ida_&hhstate.^='1') then id_&hhstate.=ida_&hhstate.; 
if missing(idb_&hhstate.) then idb_&hhstate.='0'; 
if (idb_&hhstate.^='0')&(idb_&hhstate.^='1') then id_&hhstate.=idb_&hhstate.; 
if missing(idc_&hhstate.) then idc_&hhstate.='0'; 
if (idc_&hhstate.^='0')&(idc_&hhstate.^='1') then id_&hhstate.=idc_&hhstate.; 
if missing(idd_&hhstate.) then idd_&hhstate.='0'; 
if (idd_&hhstate.^='0')&(idd_&hhstate.^='1') then id_&hhstate.=idd_&hhstate.; 
if missing(ide_&hhstate.) then ide_&hhstate.='0'; 
if (ide_&hhstate.^='0')&(ide_&hhstate.^='1') then id_&hhstate.=ide_&hhstate.; 
if missing(idf_&hhstate.) then idf_&hhstate.='0'; 
if (idf_&hhstate.^='0')&(idf_&hhstate.^='1') then id_&hhstate.=idf_&hhstate.; 
if missing(idg_&hhstate.) then idg_&hhstate.='0'; 
if (idg_&hhstate.^='0')&(idg_&hhstate.^='1') then id_&hhstate.=idg_&hhstate.; 
if missing(idh_&hhstate.) then idh_&hhstate.='0'; 
if (idh_&hhstate.^='0')&(idh_&hhstate.^='1') then id_&hhstate.=idh_&hhstate.; 
if missing(idi_&hhstate.) then idi_&hhstate.='0'; 
if (idi_&hhstate.^='0')&(idi_&hhstate.^='1') then id_&hhstate.=idi_&hhstate.; 
if missing(idj_&hhstate.) then idj_&hhstate.='0'; 
if (idj_&hhstate.^='0')&(idj_&hhstate.^='1') then id_&hhstate.=idj_&hhstate.; 
if missing(idk_&hhstate.) then idk_&hhstate.='0'; 
if (idk_&hhstate.^='0')&(idk_&hhstate.^='1') then id_&hhstate.=idk_&hhstate.;
if missing(idl_&hhstate.) then idl_&hhstate.='0'; 
if (idl_&hhstate.^='0')&(idl_&hhstate.^='1') then id_&hhstate.=idl_&hhstate.;
if missing(idm_&hhstate.) then idm_&hhstate.='0'; 
if (idm_&hhstate.^='0')&(idm_&hhstate.^='1') then id_&hhstate.=idm_&hhstate.;  
if missing(idn_&hhstate.) then idn_&hhstate.='0'; 
if (idn_&hhstate.^='0')&(idn_&hhstate.^='1') then id_&hhstate.=idn_&hhstate.; 
if missing(ido_&hhstate.) then ido_&hhstate.='0'; 
if (ido_&hhstate.^='0')&(ido_&hhstate.^='1') then id_&hhstate.=ido_&hhstate.; 
if missing(idp_&hhstate.) then idp_&hhstate.='0'; 
if (idp_&hhstate.^='0')&(idp_&hhstate.^='1') then id_&hhstate.=idp_&hhstate.; 
if missing(idq_&hhstate.) then idq_&hhstate.='0'; 
if (idq_&hhstate.^='0')&(idq_&hhstate.^='1') then id_&hhstate.=idq_&hhstate.;
if missing(idr_&hhstate.) then idr_&hhstate.='0'; 
if (idr_&hhstate.^='0')&(idr_&hhstate.^='1') then id_&hhstate.=idr_&hhstate.;
if missing(ids_&hhstate.) then ids_&hhstate.='0'; 
if (ids_&hhstate.^='0')&(ids_&hhstate.^='1') then id_&hhstate.=ids_&hhstate.; 
if missing(idt_&hhstate.) then idt_&hhstate.='0'; 
if (idt_&hhstate.^='0')&(idt_&hhstate.^='1') then id_&hhstate.=idt_&hhstate.;  
if missing(idu_&hhstate.) then idu_&hhstate.='0'; 
if (idu_&hhstate.^='0')&(idu_&hhstate.^='1') then id_&hhstate.=idu_&hhstate.;  
if hhstate=&hhstate. then id_&hhstate.='1';  
if missing(id_&hhstate.) then id_&hhstate.='0'; 

if missing(idzalpha_&hhstate.) then idzalpha_&hhstate.='0'; 
if (idzalpha_&hhstate.^='0')&(idzalpha_&hhstate.^='1') then idz_&hhstate.=idzalpha_&hhstate.; 
if missing(idza_&hhstate.) then idza_&hhstate.='0'; 
if (idza_&hhstate.^='0')&(idza_&hhstate.^='1') then idz_&hhstate.=idza_&hhstate.; 
if missing(idzb_&hhstate.) then idzb_&hhstate.='0'; 
if (idzb_&hhstate.^='0')&(idzb_&hhstate.^='1') then idz_&hhstate.=idzb_&hhstate.; 
if missing(idzc_&hhstate.) then idzc_&hhstate.='0'; 
if (idzc_&hhstate.^='0')&(idzc_&hhstate.^='1') then idz_&hhstate.=idzc_&hhstate.; 
if missing(idzd_&hhstate.) then idzd_&hhstate.='0'; 
if (idzd_&hhstate.^='0')&(idzd_&hhstate.^='1') then idz_&hhstate.=idzd_&hhstate.; 
if missing(idze_&hhstate.) then idze_&hhstate.='0'; 
if (idze_&hhstate.^='0')&(idze_&hhstate.^='1') then idz_&hhstate.=idze_&hhstate.; 
if missing(idzf_&hhstate.) then idzf_&hhstate.='0'; 
if (idzf_&hhstate.^='0')&(idzf_&hhstate.^='1') then idz_&hhstate.=idzf_&hhstate.; 
if missing(idzg_&hhstate.) then idzg_&hhstate.='0'; 
if (idzg_&hhstate.^='0')&(idzg_&hhstate.^='1') then idz_&hhstate.=idzg_&hhstate.; 
if missing(idzh_&hhstate.) then idzh_&hhstate.='0'; 
if (idzh_&hhstate.^='0')&(idzh_&hhstate.^='1') then idz_&hhstate.=idzh_&hhstate.; 
if missing(idzi_&hhstate.) then idzi_&hhstate.='0'; 
if (idzi_&hhstate.^='0')&(idzi_&hhstate.^='1') then idz_&hhstate.=idzi_&hhstate.; 
if missing(idzj_&hhstate.) then idzj_&hhstate.='0'; 
if (idzj_&hhstate.^='0')&(idzj_&hhstate.^='1') then idz_&hhstate.=idzj_&hhstate.; 
if missing(idzk_&hhstate.) then idzk_&hhstate.='0'; 
if (idzk_&hhstate.^='0')&(idzk_&hhstate.^='1') then idz_&hhstate.=idzk_&hhstate.;
if missing(idzl_&hhstate.) then idzl_&hhstate.='0'; 
if (idzl_&hhstate.^='0')&(idzl_&hhstate.^='1') then idz_&hhstate.=idzl_&hhstate.;
if missing(idzm_&hhstate.) then idzm_&hhstate.='0'; 
if (idzm_&hhstate.^='0')&(idzm_&hhstate.^='1') then idz_&hhstate.=idzm_&hhstate.;  
if missing(idzn_&hhstate.) then idzn_&hhstate.='0'; 
if (idzn_&hhstate.^='0')&(idzn_&hhstate.^='1') then idz_&hhstate.=idzn_&hhstate.; 
if missing(idzo_&hhstate.) then idzo_&hhstate.='0'; 
if (idzo_&hhstate.^='0')&(idzo_&hhstate.^='1') then idz_&hhstate.=idzo_&hhstate.; 
if missing(idzp_&hhstate.) then idzp_&hhstate.='0'; 
if (idzp_&hhstate.^='0')&(idzp_&hhstate.^='1') then idz_&hhstate.=idzp_&hhstate.; 
if missing(idzq_&hhstate.) then idzq_&hhstate.='0'; 
if (idzq_&hhstate.^='0')&(idzq_&hhstate.^='1') then idz_&hhstate.=idzq_&hhstate.;
if missing(idzr_&hhstate.) then idzr_&hhstate.='0'; 
if (idzr_&hhstate.^='0')&(idzr_&hhstate.^='1') then idz_&hhstate.=idzr_&hhstate.;
if missing(idzs_&hhstate.) then idzs_&hhstate.='0'; 
if (idzs_&hhstate.^='0')&(idzs_&hhstate.^='1') then idz_&hhstate.=idzs_&hhstate.; 
if missing(idzt_&hhstate.) then idzt_&hhstate.='0'; 
if (idzt_&hhstate.^='0')&(idzt_&hhstate.^='1') then idz_&hhstate.=idzt_&hhstate.;  
if missing(idzu_&hhstate.) then idzu_&hhstate.='0'; 
if (idzu_&hhstate.^='0')&(idzu_&hhstate.^='1') then idz_&hhstate.=idzu_&hhstate.;  
if hhstate=&hhstate. then idz_&hhstate.='1';  
if missing(idz_&hhstate.) then idz_&hhstate.='0'; 
run;  
%m_zero(&library..hh_position_&hhstate.); 
%mend; 


%hhstate2(3);%hhstate2(4);%hhstate2(5);%hhstate2(6);%hhstate2(7);%hhstate2(8);%hhstate2(9);%hhstate2(10);
proc sort data=&library..hh_position_1; 
by id; 
run; 
proc sort data=&library..hh_position_2; 
by id; 
run; 
proc sort data=&library..hh_position_3; 
by id; 
run; 
proc sort data=&library..hh_position_4; 
by id; 
run; 
proc sort data=&library..hh_position_5; 
by id; 
run; 
proc sort data=&library..hh_position_6; 
by id; 
run; 
proc sort data=&library..hh_position_7; 
by id; 
run; 
proc sort data=&library..hh_position_8; 
by id; 
run; 
proc sort data=&library..hh_position_9; 
by id; 
run; 
proc sort data=&library..hh_position_10; 
by id; 
run; 
data &library..hh_position; 
merge &library..hh_position_1-&library..hh_position_10; 
by id; 
run;
data &library..id_component1; 
set &library..temporary_base (where=(componente=51));
keep household id51;
run;  
data &library..id_component2; 
set &library..temporary_base (where=(componente=71));
keep household id71 ; 
run;  
proc sort data=&library..hh_position; by household; run; 
data &library..hh_position; 
merge &library..hh_position &library..id_component1 &library..id_component2; 
by household; 
run; 
data &library..hh_position; 
set &library..hh_position; 
if (hhstate=1) &(componente=51) then id51='1';
if (hhstate=1) &(componente=71) then id71='1'; 
if missing(id51) then id51='0'; 
if missing(id71) then id71='0'; 
if (id51^='0')&(id51^='1') then id_10=id51; 
if (id71^='0')&(id71^='1') then id_10=id71; 
if hhstate=10 then id_10='1';  
if missing(id_10) then id_10='0'; 
run;  
proc sort data=&library..hh_position; 
by household; 
run; 
proc freq data=&library..hh_position noprint ; 
by household; 
tables hhstate*ch04*marital_status /out=&library..temp;
table hhstate /out=&library..temp2; 
table ch04 /out=&library..temp3; 
table marital_status /out=&library..temp4; 
run;
data &library..temp; 
set &library..temp;
if marital_status=5 then unknown_parents=0; 
if count<=1 then unknown_parents=0; 
if hhstate=3 then do; 
if marital_status^=5 & count>1 then unknown_parents=1;
if count<=1 then do; 
unknown_parents=0; 
if marital_status=1 & ch04=1 then tag_uni_h=1; 
else tag_uni_h=0; 
if marital_status=1 & ch04=2 THEN tag_uni_f=1; 
else tag_uni_f=0; 
if marital_status=2 & ch04=1 then tag_cas_h=1; 
else tag_cas_h=0; 
if marital_status=2 & ch04=2 THEN tag_cas_f=1; 
else tag_cas_f=0;
if marital_status=3 & ch04=1 then tag_div_h=1; 
else tag_div_h=0; 
if marital_status=3 & ch04=2 THEN tag_div_f=1; 
else tag_div_f=0; 
if marital_status=4 & ch04=1 then tag_wid_h=1; 
else tag_wid_h=0; 
if marital_status=4 & ch04=2 THEN tag_wid_f=1; 
else tag_wid_f=0; 
end; end; 
if hhstate^=3 then do; 
unknown_parents=0; 
tag_uni_h=0; 
tag_uni_f=0; 
tag_wid_h=0; 
tag_wid_f=0; 
tag_cas_h=0; 
tag_cas_f=0; 
tag_div_h=0; 
tag_div_f=0; 
end; 
 

if (marital_status=1|marital_status=2)& ch04=1 & hhstate=3 & count=1 then hijo_eligible=1; 
else hijo_eligible=0; 
if (marital_status=1|marital_status=2)& ch04=2 & hhstate=3 & count=1 then hija_eligible=1; 
else hija_eligible=0; 
if (marital_status=1|marital_status=2)& ch04=1 & hhstate=4 & count=1 then yerno_eligible=1; 
else yerno_eligible=0; 
if (marital_status=1|marital_status=2)& ch04=2 & hhstate=4 & count=1 then nuera_eligible=1; 
else nuera_eligible=0; 
if (marital_status=1)& ch04=1 & hhstate=3 & count=1 then hijo_uni_eligible=1; 
else hijo_uni_eligible=0; 
if (marital_status=1)& ch04=2 & hhstate=3 & count=1 then hija_uni_eligible=1; 
else hija_uni_eligible=0; 
if (marital_status=1)& ch04=1 & hhstate=4 & count=1 then yerno_uni_eligible=1; 
else yerno_uni_eligible=0; 
if (marital_status=1)& ch04=2 & hhstate=4 & count=1 then nuera_uni_eligible=1; 
else nuera_uni_eligible=0; 
if (marital_status=2)& ch04=1 & hhstate=3 & count=1 then hijo_cas_eligible=1; 
else hijo_cas_eligible=0; 
if (marital_status=2)& ch04=2 & hhstate=3 & count=1 then hija_cas_eligible=1; 
else hija_cas_eligible=0; 
if (marital_status=2)& ch04=1 & hhstate=4 & count=1 then yerno_cas_eligible=1; 
else yerno_cas_eligible=0; 
if (marital_status=2)& ch04=2 & hhstate=4 & count=1 then nuera_cas_eligible=1; 
else nuera_cas_eligible=0; 
if hijo_eligible=0 & hija_eligible=0 & yerno_eligible=0 & nuera_eligible=0 then do; 
if (marital_status=3|marital_status=4)& ch04=1 & hhstate=3 & count=1 then hijo_eligible_2=1; 
else hijo_eligible_2=0; 
if (marital_status=3|marital_status=4)& ch04=2 & hhstate=3 & count=1 then hija_eligible_2=1; 
else hija_eligible_2=0; 
if (marital_status=3)& ch04=1 & hhstate=3 & count=1 then hijo_div_eligible=1; 
else hijo_div_eligible=0; 
if (marital_status=3)& ch04=2 & hhstate=3 & count=1 then hija_div_eligible=1; 
else hija_div_eligible=0; 
if (marital_status=4)& ch04=1 & hhstate=3 & count=1 then hijo_wid_eligible=1; 
else hijo_wid_eligible=0; 
if (marital_status=4)& ch04=2 & hhstate=3 & count=1 then hija_wid_eligible=1; 
else hija_wid_eligible=0; 
end; 
else do; 
hijo_eligible_2=0; 
hija_eligible_2=0; 
hijo_div_eligible=0; 
hija_div_eligible=0; 
hijo_wid_eligible=0; 
hija_wid_eligible=0; 
end; 
ruN; 
data &library..temp_tag_a; 
set &library..temp; 
where unknown_parents=1; 
keep household unknown_parents; 
run; 
data &library..temp_tag_b; 
set &library..temp; 
where 
tag_uni_h=1; 
keep household tag_uni_h; 
run; 
data &library..temp_tag_c; 
set &library..temp; 
where 
tag_uni_f=1; 
keep household tag_uni_f; 
run; 
data &library..temp_tag_d; 
set &library..temp; 
where 
tag_cas_h=1; 
keep household tag_cas_h; 
run; 
data &library..temp_tag_e; 
set &library..temp; 
where 
tag_cas_f=1; 
keep household tag_cas_f; 
run; 
data &library..temp_tag_f; 
set &library..temp; 
where 
tag_div_h=1; 
keep household tag_div_h; 
run; 
data &library..temp_tag_g; 
set &library..temp; 
where 
tag_div_f=1; 
keep household tag_div_f; 
run; 

data &library..temp_tag_h; 
set &library..temp; 
where 
tag_wid_h=1; 
keep household tag_wid_h; 
run; 
data &library..temp_tag_i; 
set &library..temp; 
where 
tag_wid_f=1; 
keep household tag_wid_f; 
run; 
data &library..tempa; 
set &library..temp; 
where hijo_eligible=1; 
keep household hijo_eligible; 
run; 
data &library..tempb; 
set &library..temp; 
where hija_eligible=1; 
keep household hija_eligible; 
run; 
data &library..tempc; 
set &library..temp; 
where yerno_eligible=1; 
keep household yerno_eligible; 
run; 
data &library..tempd; 
set &library..temp; 
where nuera_eligible=1; 
keep household nuera_eligible; 
run; 
data &library..temp_uni_a; 
set &library..temp; 
where hijo_uni_eligible=1;
keep household hijo_uni_eligible;  
run; 
data &library..temp_uni_b; 
set &library..temp; 
where hija_uni_eligible=1; 
keep household hija_uni_eligible; 
run; 
data &library..temp_uni_c; 
set &library..temp; 
where yerno_uni_eligible=1; 
keep household yerno_uni_eligible; 
run; 
data &library..temp_uni_d; 
set &library..temp; 
where nuera_uni_eligible=1; 
keep household nuera_uni_eligible; 
run; 
data &library..temp_cas_a; 
set &library..temp; 
where hijo_cas_eligible=1; 
keep household hijo_cas_eligible; 
run; 
data &library..temp_cas_b; 
set &library..temp; 
where hija_cas_eligible=1;
keep household hija_cas_eligible;  
run; 
data &library..temp_cas_c; 
set &library..temp; 
where yerno_cas_eligible=1; 
keep household yerno_cas_eligible; 
run; 
data &library..temp_cas_d; 
set &library..temp; 
where nuera_cas_eligible=1; 
keep household nuera_cas_eligible; 
run; 


data &library..tempe; 
set &library..temp; 
where hijo_eligible_2=1; 
keep household hijo_eligible_2; 
run; 
data &library..tempf; 
set &library..temp; 
where hija_eligible_2=1; 
keep household hija_eligible_2; 
run; 
data &library..tempe_div; 
set &library..temp; 
where hijo_div_eligible=1; 
keep household hijo_div_eligible; 
run; 
data &library..tempf_div; 
set &library..temp; 
where hija_div_eligible=1; 
keep household hija_div_eligible; 
run; 
data &library..tempe_wid; 
set &library..temp; 
where hijo_wid_eligible=1; 
keep household hijo_wid_eligible; 
run; 
data &library..tempf_wid; 
set &library..temp; 
where hija_wid_eligible=1; 
keep household hija_wid_eligible; 
run; /*
data &library..save; 
set &library..hh_position; 
run; */
data &library..hh_position; 
set &library..hh_position; 
drop unknown_parents; run; 
proc sort data=&library..hh_position; 
by household; 
run; 
data &library..hh_position; 
merge &library..hh_position &library..tempa &library..tempb &library..tempc &library..tempd &library..temp_uni_a &library..temp_uni_b &library..temp_uni_c &library..temp_uni_d  &library..temp_cas_a &library..temp_cas_b &library..temp_cas_c &library..temp_cas_d &library..tempe &library..tempf &library..tempe_div &library..tempf_div &library..tempe_wid &library..tempf_wid
&library..temp_tag_a &library..temp_tag_b &library..temp_tag_c &library..temp_tag_d &library..temp_tag_e &library..temp_tag_f &library..temp_tag_g &library..temp_tag_h &library..temp_tag_i; 
by household; 
run;
%m_zero(&library..hh_position);
proc contents data=leo.hh_position; run; 
data &library..hh_position; 
set &library..hh_position; 
tag=tag_uni_h + tag_Uni_f + tag_cas_h + tag_cas_f + tag_div_h + tag_div_f + tag_wid_h + tag_wid_f; 
if tag>1 | unknown_parents=1 then hijos_identif=0; 
if tag<=1 & unknown_parents=0 then hijos_identif=1; 
if ((hhstate=1) & (jefe_id='1')) then partner_id=partenaire_id; 
if ((hhstate=2) & (partenaire_id='1')) then partner_id=jefe_id;  
if ((hhstate=3) & (marital_status=1)&(ch04=2) & hija_uni_eligible=1)then do; 
if idalpha_civ_4='1' then partner_id=idalpha_4; 
else if ida_civ_4='1' then partner_id=ida_4; 
else if idb_civ_4='1' then partner_id=idb_4; 
else if idc_civ_4='1' then partner_id=idc_4; 
else if idd_civ_4='1' then partner_id=idd_4; 
else if ide_civ_4='1' then partner_id=ide_4; 
else if idf_civ_4='1' then partner_id=idf_4; 
else if idg_civ_4='1' then partner_id=idg_4; 
else if idh_civ_4='1' then partner_id=idh_4; 
else if idi_civ_4='1' then partner_id=idi_4; 
else if idj_civ_4='1' then partner_id=idj_4; 
else if idk_civ_4='1' then partner_id=idk_4; 
else if idl_civ_4='1' then partner_id=idl_4; 
else if idm_civ_4='1' then partner_id=idm_4; 
else if idn_civ_4='1' then partner_id=idn_4; 
else if ido_civ_4='1' then partner_id=ido_4; 
else if idp_civ_4='1' then partner_id=idp_4; 
else if idq_civ_4='1' then partner_id=idq_4; 
else if idr_civ_4='1' then partner_id=idr_4; 
else if ids_civ_4='1' then partner_id=ids_4; 
else if idt_civ_4='1' then partner_id=idt_4; 
else if idu_civ_4='1' then partner_id=idu_4; 
end; 
if ((hhstate=3) & (marital_status=2)&(ch04=2) & hija_cas_eligible=1)then do; 
if idalpha_civ_4='2' then partner_id=idalpha_4;
else if ida_civ_4='2' then partner_id=ida_4; 
else if idb_civ_4='2' then partner_id=idb_4; 
else if idc_civ_4='2' then partner_id=idc_4; 
else if idd_civ_4='2' then partner_id=idd_4; 
else if ide_civ_4='2' then partner_id=ide_4; 
else if idf_civ_4='2' then partner_id=idf_4; 
else if idg_civ_4='2' then partner_id=idg_4; 
else if idh_civ_4='2' then partner_id=idh_4; 
else if idi_civ_4='2' then partner_id=idi_4; 
else if idj_civ_4='2' then partner_id=idj_4; 
else if idk_civ_4='2' then partner_id=idk_4; 
else if idl_civ_4='2' then partner_id=idl_4; 
else if idm_civ_4='2' then partner_id=idm_4; 
else if idn_civ_4='2' then partner_id=idn_4; 
else if ido_civ_4='2' then partner_id=ido_4; 
else if idp_civ_4='2' then partner_id=idp_4; 
else if idq_civ_4='2' then partner_id=idq_4; 
else if idr_civ_4='2' then partner_id=idr_4; 
else if ids_civ_4='2' then partner_id=ids_4; 
else if idt_civ_4='2' then partner_id=idt_4; 
else if idu_civ_4='2' then partner_id=idu_4; 
end; 

if ((hhstate=3) & (marital_status=1)&(ch04=1) & hijo_uni_eligible=1)then do; 
if idzalpha_civ_4='1' then partner_id=idzalpha_4; 
else if idza_civ_4='1' then partner_id=idza_4; 
else if idzb_civ_4='1' then partner_id=idzb_4; 
else if idzc_civ_4='1' then partner_id=idzc_4; 
else if idzd_civ_4='1' then partner_id=idzd_4; 
else if idze_civ_4='1' then partner_id=idze_4; 
else if idzf_civ_4='1' then partner_id=idzf_4; 
else if idzg_civ_4='1' then partner_id=idzg_4; 
else if idzh_civ_4='1' then partner_id=idzh_4; 
else if idzi_civ_4='1' then partner_id=idzi_4; 
else if idzj_civ_4='1' then partner_id=idzj_4; 
else if idzk_civ_4='1' then partner_id=idzk_4; 
else if idzl_civ_4='1' then partner_id=idzl_4; 
else if idzm_civ_4='1' then partner_id=idzm_4; 
else if idzn_civ_4='1' then partner_id=idzn_4; 
else if idzo_civ_4='1' then partner_id=idzo_4; 
else if idzp_civ_4='1' then partner_id=idzp_4; 
else if idzq_civ_4='1' then partner_id=idzq_4; 
else if idzr_civ_4='1' then partner_id=idzr_4; 
else if idzs_civ_4='1' then partner_id=idzs_4; 
else if idzt_civ_4='1' then partner_id=idzt_4; 
else if idzu_civ_4='1' then partner_id=idzu_4; 
end; 
if ((hhstate=3) & (marital_status=2)&(ch04=1) & hijo_cas_eligible=1)then do; 
if idzalpha_civ_4='2' then partner_id=idzalpha_4; 
else if idza_civ_4='2' then partner_id=idza_4; 
else if idzb_civ_4='2' then partner_id=idzb_4; 
else if idzc_civ_4='2' then partner_id=idzc_4; 
else if idzd_civ_4='2' then partner_id=idzd_4; 
else if idze_civ_4='2' then partner_id=idze_4; 
else if idzf_civ_4='2' then partner_id=idzf_4; 
else if idzg_civ_4='2' then partner_id=idzg_4; 
else if idzh_civ_4='2' then partner_id=idzh_4; 
else if idzi_civ_4='2' then partner_id=idzi_4; 
else if idzj_civ_4='2' then partner_id=idzj_4; 
else if idzk_civ_4='2' then partner_id=idzk_4; 
else if idzl_civ_4='2' then partner_id=idzl_4; 
else if idzm_civ_4='2' then partner_id=idzm_4; 
else if idzn_civ_4='2' then partner_id=idzn_4; 
else if idzo_civ_4='2' then partner_id=idzo_4; 
else if idzp_civ_4='2' then partner_id=idzp_4; 
else if idzq_civ_4='2' then partner_id=idzq_4; 
else if idzr_civ_4='2' then partner_id=idzr_4; 
else if idzs_civ_4='2' then partner_id=idzs_4; 
else if idzt_civ_4='2' then partner_id=idzt_4; 
else if idzu_civ_4='2' then partner_id=idzu_4; 
end; 

if ((hhstate=4) & (marital_status=1)&(ch04=2) & nuera_uni_eligible=1)then do; 
if idalpha_civ_3='1' then partner_id=idalpha_3; 
else if ida_civ_3='1' then partner_id=ida_3; 
else if idb_civ_3='1' then partner_id=idb_3; 
else if idc_civ_3='1' then partner_id=idc_3; 
else if idd_civ_3='1' then partner_id=idd_3; 
else if ide_civ_3='1' then partner_id=ide_3; 
else if idf_civ_3='1' then partner_id=idf_3; 
else if idg_civ_3='1' then partner_id=idg_3; 
else if idh_civ_3='1' then partner_id=idh_3; 
else if idi_civ_3='1' then partner_id=idi_3; 
else if idj_civ_3='1' then partner_id=idj_3; 
else if idk_civ_3='1' then partner_id=idk_3; 
else if idl_civ_3='1' then partner_id=idl_3; 
else if idm_civ_3='1' then partner_id=idm_3; 
else if idn_civ_3='1' then partner_id=idn_3; 
else if ido_civ_3='1' then partner_id=ido_3; 
else if idp_civ_3='1' then partner_id=idp_3; 
else if idq_civ_3='1' then partner_id=idq_3; 
else if idr_civ_3='1' then partner_id=idr_3; 
else if ids_civ_3='1' then partner_id=ids_3; 
else if idt_civ_3='1' then partner_id=idt_3; 
else if idu_civ_3='1' then partner_id=idu_3; 
end; 
if ((hhstate=4) & (marital_status=2)&(ch04=2) & nuera_cas_eligible=1)then do; 
if idalpha_civ_3='2' then partner_id=idalpha_3; 
else if ida_civ_3='2' then partner_id=ida_3; 
else if idb_civ_3='2' then partner_id=idb_3; 
else if idc_civ_3='2' then partner_id=idc_3; 
else if idd_civ_3='2' then partner_id=idd_3; 
else if ide_civ_3='2' then partner_id=ide_3; 
else if idf_civ_3='2' then partner_id=idf_3; 
else if idg_civ_3='2' then partner_id=idg_3; 
else if idh_civ_3='2' then partner_id=idh_3; 
else if idi_civ_3='2' then partner_id=idi_3; 
else if idj_civ_3='2' then partner_id=idj_3; 
else if idk_civ_3='2' then partner_id=idk_3; 
else if idl_civ_3='2' then partner_id=idl_3; 
else if idm_civ_3='2' then partner_id=idm_3; 
else if idn_civ_3='2' then partner_id=idn_3; 
else if ido_civ_3='2' then partner_id=ido_3; 
else if idp_civ_3='2' then partner_id=idp_3; 
else if idq_civ_3='2' then partner_id=idq_3; 
else if idr_civ_3='2' then partner_id=idr_3; 
else if ids_civ_3='2' then partner_id=ids_3; 
else if idt_civ_3='2' then partner_id=idt_3; 
else if idu_civ_3='2' then partner_id=idu_3; 
end; 

if ((hhstate=4) & (marital_status=1)&(ch04=1) & yerno_uni_eligible=1)then do; 
if idzalpha_civ_3='1' then partner_id=idzalpha_3; 
else if idza_civ_3='1' then partner_id=idza_3;
else if idzb_civ_3='1' then partner_id=idzb_3; 
else if idzc_civ_3='1' then partner_id=idzc_3; 
else if idzd_civ_3='1' then partner_id=idzd_3; 
else if idze_civ_3='1' then partner_id=idze_3; 
else if idzf_civ_3='1' then partner_id=idzf_3; 
else if idzg_civ_3='1' then partner_id=idzg_3; 
else if idzh_civ_3='1' then partner_id=idzh_3; 
else if idzi_civ_3='1' then partner_id=idzi_3; 
else if idzj_civ_3='1' then partner_id=idzj_3; 
else if idzk_civ_3='1' then partner_id=idzk_3; 
else if idzl_civ_3='1' then partner_id=idzl_3; 
else if idzm_civ_3='1' then partner_id=idzm_3; 
else if idzn_civ_3='1' then partner_id=idzn_3; 
else if idzo_civ_3='1' then partner_id=idzo_3; 
else if idzp_civ_3='1' then partner_id=idzp_3; 
else if idzq_civ_3='1' then partner_id=idzq_3; 
else if idzr_civ_3='1' then partner_id=idzr_3; 
else if idzs_civ_3='1' then partner_id=idzs_3; 
else if idzt_civ_3='1' then partner_id=idzt_3; 
else if idzu_civ_3='1' then partner_id=idzu_3; 
end; 
if ((hhstate=4) & (marital_status=2)&(ch04=1) & yerno_cas_eligible=1)then do; 
if idzalpha_civ_3='2' then partner_id=idzalpha_3;
else if idza_civ_3='2' then partner_id=idza_3;  
else if idzb_civ_3='2' then partner_id=idzb_3; 
else if idzc_civ_3='2' then partner_id=idzc_3; 
else if idzd_civ_3='2' then partner_id=idzd_3; 
else if idze_civ_3='2' then partner_id=idze_3; 
else if idzf_civ_3='2' then partner_id=idzf_3; 
else if idzg_civ_3='2' then partner_id=idzg_3; 
else if idzh_civ_3='2' then partner_id=idzh_3; 
else if idzi_civ_3='2' then partner_id=idzi_3; 
else if idzj_civ_3='2' then partner_id=idzj_3; 
else if idzk_civ_3='2' then partner_id=idzk_3; 
else if idzl_civ_3='2' then partner_id=idzl_3; 
else if idzm_civ_3='2' then partner_id=idzm_3; 
else if idzn_civ_3='2' then partner_id=idzn_3; 
else if idzo_civ_3='2' then partner_id=idzo_3; 
else if idzp_civ_3='2' then partner_id=idzp_3; 
else if idzq_civ_3='2' then partner_id=idzq_3; 
else if idzr_civ_3='2' then partner_id=idzr_3; 
else if idzs_civ_3='2' then partner_id=idzs_3; 
else if idzt_civ_3='2' then partner_id=idzt_3; 
else if idzu_civ_3='2' then partner_id=idzu_3; 
end; 
if ((hhstate=6)& (id_6^='1')&(ch04=2)) then partner_id=id_6; 
if ((hhstate=6)& (idz_6^='1')&(ch04=1)) then partner_id=idz_6;
if ((hhstate=7) & (id_7^='1') & (ch04=2)) then partner_id=id_7;
if ((hhstate=7) & (idz_7^='1') & (ch04=1)) then partner_id=idz_7;
if missing(partner_id) then partner_id='0';  
if missing(idza_1) then idza_1='0'; 
if missing(ida_1) then ida_1='0'; 
if ((hhstate=1) & (jefe_id='1')) then mother_id=idz_6; 
if ((hhstate=1) & (jefe_id='1')) then father_id=id_6; 
if ((hhstate=2) & (partner_id='1')) then mother_id=idz_7;
if ((hhstate=2) & (partner_id='1')) then father_id=id_7; 

if ((hhstate=3)&(idza_1^='0')&(idzb_1='0')) then mother_id=idza_1;
if ((hhstate=3)&(idza_1='0')&(idzb_1^='0')) then mother_id=idzb_1;
if ((hhstate=3)&(ida_1^='0')&(idb_1='0')) then father_id=ida_1;
if ((hhstate=3)&(ida_1='0')&(idb_1^='0')) then father_id=idb_1;

if ((hhstate=3)&(idza_2^='0')&(idzb_2='0')) then mother_id=idza_2;
if ((hhstate=3)&(idza_2='0')&(idzb_2^='0')) then mother_id=idzb_2;
if ((hhstate=3)&(ida_2^='0')&(idb_2='0')) then father_id=ida_2;
if ((hhstate=3)&(ida_2='0')&(idb_2^='0')) then father_id=idb_2;
if hhstate=5 & hijos_identif=1 then do; 
if hija_uni_eligible=1 then do; 
if idzalpha_civ_3='1' then mother_id=idzalpha_3; 
else if idza_civ_3='1' then mother_id=idza_3; 
else if idzb_civ_3='1' then mother_id=idzb_3; 
else if idzc_civ_3='1' then mother_id=idzc_3; 
else if idzd_civ_3='1' then mother_id=idzd_3; 
else if idze_civ_3='1' then mother_id=idze_3; 
else if idzf_civ_3='1' then mother_id=idzf_3; 
else if idzg_civ_3='1' then mother_id=idzg_3; 
else if idzh_civ_3='1' then mother_id=idzh_3; 
else if idzi_civ_3='1' then mother_id=idzi_3; 
else if idzj_civ_3='1' then mother_id=idzj_3; 
else if idzk_civ_3='1' then mother_id=idzk_3; 
else if idzl_civ_3='1' then mother_id=idzl_3; 
else if idzm_civ_3='1' then mother_id=idzm_3; 
else if idzn_civ_3='1' then mother_id=idzn_3; 
else if idzo_civ_3='1' then mother_id=idzo_3; 
else if idzp_civ_3='1' then mother_id=idzp_3; 
else if idzq_civ_3='1' then mother_id=idzq_3; 
else if idzr_civ_3='1' then mother_id=idzr_3; 
else if idzs_civ_3='1' then mother_id=idzs_3; 
else if idzt_civ_3='1' then mother_id=idzt_3; 
else if idzu_civ_3='1' then mother_id=idzu_3; 
end; 
if hijo_uni_eligible=1 then do; 
if idalpha_civ_3='1' then father_id=idalpha_3; 
else if ida_civ_3='1' then father_id=ida_3; 
else if idb_civ_3='1' then father_id=idb_3; 
else if idc_civ_3='1' then father_id=idc_3; 
else if idd_civ_3='1' then father_id=idd_3; 
else if ide_civ_3='1' then father_id=ide_3; 
else if idf_civ_3='1' then father_id=idf_3; 
else if idg_civ_3='1' then father_id=idg_3; 
else if idh_civ_3='1' then father_id=idh_3; 
else if idi_civ_3='1' then father_id=idi_3; 
else if idj_civ_3='1' then father_id=idj_3; 
else if idk_civ_3='1' then father_id=idk_3; 
else if idl_civ_3='1' then father_id=idl_3; 
else if idm_civ_3='1' then father_id=idm_3; 
else if idn_civ_3='1' then father_id=idn_3; 
else if ido_civ_3='1' then father_id=ido_3; 
else if idp_civ_3='1' then father_id=idp_3; 
else if idq_civ_3='1' then father_id=idq_3; 
else if idr_civ_3='1' then father_id=idr_3; 
else if ids_civ_3='1' then father_id=ids_3; 
else if idt_civ_3='1' then father_id=idt_3; 
else if idu_civ_3='1' then father_id=idu_3; 
end; 
if hija_cas_eligible=1 then do; 
if idzalpha_civ_3='2' then mother_id=idzalpha_3;
else if idza_civ_3='2' then mother_id=idza_3; 
else if idzb_civ_3='2' then mother_id=idzb_3; 
else if idzc_civ_3='2' then mother_id=idzc_3; 
else if idzd_civ_3='2' then mother_id=idzd_3; 
else if idze_civ_3='2' then mother_id=idze_3; 
else if idzf_civ_3='2' then mother_id=idzf_3; 
else if idzg_civ_3='2' then mother_id=idzg_3; 
else if idzh_civ_3='2' then mother_id=idzh_3; 
else if idzi_civ_3='2' then mother_id=idzi_3; 
else if idzj_civ_3='2' then mother_id=idzj_3; 
else if idzk_civ_3='2' then mother_id=idzk_3; 
else if idzl_civ_3='2' then mother_id=idzl_3; 
else if idzm_civ_3='2' then mother_id=idzm_3; 
else if idzn_civ_3='2' then mother_id=idzn_3; 
else if idzo_civ_3='2' then mother_id=idzo_3; 
else if idzp_civ_3='2' then mother_id=idzp_3; 
else if idzq_civ_3='2' then mother_id=idzq_3; 
else if idzr_civ_3='2' then mother_id=idzr_3; 
else if idzs_civ_3='2' then mother_id=idzs_3; 
else if idzt_civ_3='2' then mother_id=idzt_3; 
else if idzu_civ_3='2' then mother_id=idzu_3; 
end; 
if hijo_cas_eligible=1 then do; 
if idalpha_civ_3='2' then father_id=idalpha_3; 
else if ida_civ_3='2' then father_id=ida_3; 
else if idb_civ_3='2' then father_id=idb_3; 
else if idc_civ_3='2' then father_id=idc_3; 
else if idd_civ_3='2' then father_id=idd_3; 
else if ide_civ_3='2' then father_id=ide_3; 
else if idf_civ_3='2' then father_id=idf_3; 
else if idg_civ_3='2' then father_id=idg_3; 
else if idh_civ_3='2' then father_id=idh_3; 
else if idi_civ_3='2' then father_id=idi_3; 
else if idj_civ_3='2' then father_id=idj_3; 
else if idk_civ_3='2' then father_id=idk_3; 
else if idl_civ_3='2' then father_id=idl_3; 
else if idm_civ_3='2' then father_id=idm_3; 
else if idn_civ_3='2' then father_id=idn_3; 
else if ido_civ_3='2' then father_id=ido_3; 
else if idp_civ_3='2' then father_id=idp_3; 
else if idq_civ_3='2' then father_id=idq_3; 
else if idr_civ_3='2' then father_id=idr_3; 
else if ids_civ_3='2' then father_id=ids_3; 
else if idt_civ_3='2' then father_id=idt_3; 
else if idu_civ_3='2' then father_id=idu_3; 
end; 
if nuera_uni_eligible=1 then do; 
if idzalpha_civ_4='1' then mother_id=idzalpha_4; 
else if idza_civ_4='1' then mother_id=idza_4; 
else if idzb_civ_4='1' then mother_id=idzb_4; 
else if idzc_civ_4='1' then mother_id=idzc_4; 
else if idzd_civ_4='1' then mother_id=idzd_4; 
else if idze_civ_4='1' then mother_id=idze_4; 
else if idzf_civ_4='1' then mother_id=idzf_4; 
else if idzg_civ_4='1' then mother_id=idzg_4; 
else if idzh_civ_4='1' then mother_id=idzh_4; 
else if idzi_civ_4='1' then mother_id=idzi_4; 
else if idzj_civ_4='1' then mother_id=idzj_4; 
else if idzk_civ_4='1' then mother_id=idzk_4; 
else if idzl_civ_4='1' then mother_id=idzl_4; 
else if idzm_civ_4='1' then mother_id=idzm_4; 
else if idzn_civ_4='1' then mother_id=idzn_4; 
else if idzo_civ_4='1' then mother_id=idzo_4; 
else if idzp_civ_4='1' then mother_id=idzp_4; 
else if idzq_civ_4='1' then mother_id=idzq_4; 
else if idzr_civ_4='1' then mother_id=idzr_4; 
else if idzs_civ_4='1' then mother_id=idzs_4; 
else if idzt_civ_4='1' then mother_id=idzt_4; 
else if idzu_civ_4='1' then mother_id=idzu_4; 
end; 
if yerno_uni_eligible=1 then do; 
if idalpha_civ_4='1' then father_id=idalpha_4; 
else if ida_civ_4='1' then father_id=ida_4; 
else if idb_civ_4='1' then father_id=idb_4; 
else if idc_civ_4='1' then father_id=idc_4; 
else if idd_civ_4='1' then father_id=idd_4; 
else if ide_civ_4='1' then father_id=ide_4; 
else if idf_civ_4='1' then father_id=idf_4; 
else if idg_civ_4='1' then father_id=idg_4; 
else if idh_civ_4='1' then father_id=idh_4; 
else if idi_civ_4='1' then father_id=idi_4; 
else if idj_civ_4='1' then father_id=idj_4; 
else if idk_civ_4='1' then father_id=idk_4; 
else if idl_civ_4='1' then father_id=idl_4; 
else if idm_civ_4='1' then father_id=idm_4; 
else if idn_civ_4='1' then father_id=idn_4; 
else if ido_civ_4='1' then father_id=ido_4; 
else if idp_civ_4='1' then father_id=idp_4; 
else if idq_civ_4='1' then father_id=idq_4; 
else if idr_civ_4='1' then father_id=idr_4; 
else if ids_civ_4='1' then father_id=ids_4; 
else if idt_civ_4='1' then father_id=idt_4; 
else if idu_civ_4='1' then father_id=idu_4; 
end; 
if nuera_cas_eligible=1 then do; 
if idzalpha_civ_4='2' then mother_id=idzalpha_4;
else if idza_civ_4='2' then mother_id=idza_4; 
else if idzb_civ_4='2' then mother_id=idzb_4; 
else if idzc_civ_4='2' then mother_id=idzc_4; 
else if idzd_civ_4='2' then mother_id=idzd_4; 
else if idze_civ_4='2' then mother_id=idze_4; 
else if idzf_civ_4='2' then mother_id=idzf_4; 
else if idzg_civ_4='2' then mother_id=idzg_4; 
else if idzh_civ_4='2' then mother_id=idzh_4; 
else if idzi_civ_4='2' then mother_id=idzi_4; 
else if idzj_civ_4='2' then mother_id=idzj_4; 
else if idzk_civ_4='2' then mother_id=idzk_4; 
else if idzl_civ_4='2' then mother_id=idzl_4; 
else if idzm_civ_4='2' then mother_id=idzm_4; 
else if idzn_civ_4='2' then mother_id=idzn_4; 
else if idzo_civ_4='2' then mother_id=idzo_4; 
else if idzp_civ_4='2' then mother_id=idzp_4; 
else if idzq_civ_4='2' then mother_id=idzq_4; 
else if idzr_civ_4='2' then mother_id=idzr_4; 
else if idzs_civ_4='2' then mother_id=idzs_4; 
else if idzt_civ_4='2' then mother_id=idzt_4; 
else if idzu_civ_4='2' then mother_id=idzu_4; 
end; 
if yerno_cas_eligible=1 then do; 
if idalpha_civ_4='2' then father_id=idalpha_4; 
else if ida_civ_4='2' then father_id=ida_4; 
else if idb_civ_4='2' then father_id=idb_4; 
else if idc_civ_4='2' then father_id=idc_4; 
else if idd_civ_4='2' then father_id=idd_4; 
else if ide_civ_4='2' then father_id=ide_4; 
else if idf_civ_4='2' then father_id=idf_4; 
else if idg_civ_4='2' then father_id=idg_4; 
else if idh_civ_4='2' then father_id=idh_4; 
else if idi_civ_4='2' then father_id=idi_4; 
else if idj_civ_4='2' then father_id=idj_4; 
else if idk_civ_4='2' then father_id=idk_4; 
else if idl_civ_4='2' then father_id=idl_4; 
else if idm_civ_4='2' then father_id=idm_4; 
else if idn_civ_4='2' then father_id=idn_4; 
else if ido_civ_4='2' then father_id=ido_4; 
else if idp_civ_4='2' then father_id=idp_4; 
else if idq_civ_4='2' then father_id=idq_4; 
else if idr_civ_4='2' then father_id=idr_4; 
else if ids_civ_4='2' then father_id=ids_4; 
else if idt_civ_4='2' then father_id=idt_4; 
else if idu_civ_4='2' then father_id=idu_4; 
end; 

 
if hija_div_eligible=1 then do; 
if idzalpha_civ_3='3' then mother_id=idzalpha_3; 
else if idza_civ_3='3' then mother_id=idza_3; 
else if idzb_civ_3='3' then mother_id=idzb_3; 
else if idzc_civ_3='3' then mother_id=idzc_3; 
else if idzd_civ_3='3' then mother_id=idzd_3; 
else if idze_civ_3='3' then mother_id=idze_3; 
else if idzf_civ_3='3' then mother_id=idzf_3; 
else if idzg_civ_3='3' then mother_id=idzg_3; 
else if idzh_civ_3='3' then mother_id=idzh_3; 
else if idzi_civ_3='3' then mother_id=idzi_3; 
else if idzj_civ_3='3' then mother_id=idzj_3; 
else if idzk_civ_3='3' then mother_id=idzk_3; 
else if idzl_civ_3='3' then mother_id=idzl_3; 
else if idzm_civ_3='3' then mother_id=idzm_3; 
else if idzn_civ_3='3' then mother_id=idzn_3; 
else if idzo_civ_3='3' then mother_id=idzo_3; 
else if idzp_civ_3='3' then mother_id=idzp_3; 
else if idzq_civ_3='3' then mother_id=idzq_3; 
else if idzr_civ_3='3' then mother_id=idzr_3; 
else if idzs_civ_3='3' then mother_id=idzs_3; 
else if idzt_civ_3='3' then mother_id=idzt_3; 
else if idzu_civ_3='3' then mother_id=idzu_3; 
end; 
if hijo_div_eligible=1 then do; 
if idalpha_civ_3='3' then father_id=idalpha_3; 
else if ida_civ_3='3' then father_id=ida_3; 
else if idb_civ_3='3' then father_id=idb_3; 
else if idc_civ_3='3' then father_id=idc_3; 
else if idd_civ_3='3' then father_id=idd_3; 
else if ide_civ_3='3' then father_id=ide_3; 
else if idf_civ_3='3' then father_id=idf_3; 
else if idg_civ_3='3' then father_id=idg_3; 
else if idh_civ_3='3' then father_id=idh_3; 
else if idi_civ_3='3' then father_id=idi_3; 
else if idj_civ_3='3' then father_id=idj_3; 
else if idk_civ_3='3' then father_id=idk_3; 
else if idl_civ_3='3' then father_id=idl_3; 
else if idm_civ_3='3' then father_id=idm_3; 
else if idn_civ_3='3' then father_id=idn_3; 
else if ido_civ_3='3' then father_id=ido_3; 
else if idp_civ_3='3' then father_id=idp_3; 
else if idq_civ_3='3' then father_id=idq_3; 
else if idr_civ_3='3' then father_id=idr_3; 
else if ids_civ_3='3' then father_id=ids_3; 
else if idt_civ_3='3' then father_id=idt_3; 
else if idu_civ_3='3' then father_id=idu_3; 
end; 

 
if hija_wid_eligible=1 then do; 
if idzalpha_civ_3='4' then mother_id=idzalpha_3; 
else if idza_civ_3='4' then mother_id=idza_3; 
else if idzb_civ_3='4' then mother_id=idzb_3; 
else if idzc_civ_3='4' then mother_id=idzc_3; 
else if idzd_civ_3='4' then mother_id=idzd_3; 
else if idze_civ_3='4' then mother_id=idze_3; 
else if idzf_civ_3='4' then mother_id=idzf_3; 
else if idzg_civ_3='4' then mother_id=idzg_3; 
else if idzh_civ_3='4' then mother_id=idzh_3; 
else if idzi_civ_3='4' then mother_id=idzi_3; 
else if idzj_civ_3='4' then mother_id=idzj_3; 
else if idzk_civ_3='4' then mother_id=idzk_3; 
else if idzl_civ_3='4' then mother_id=idzl_3; 
else if idzm_civ_3='4' then mother_id=idzm_3; 
else if idzn_civ_3='4' then mother_id=idzn_3; 
else if idzo_civ_3='4' then mother_id=idzo_3; 
else if idzp_civ_3='4' then mother_id=idzp_3; 
else if idzq_civ_3='4' then mother_id=idzq_3; 
else if idzr_civ_3='4' then mother_id=idzr_3; 
else if idzs_civ_3='4' then mother_id=idzs_3; 
else if idzt_civ_3='4' then mother_id=idzt_3; 
else if idzu_civ_3='4' then mother_id=idzu_3; 
end; 
if hijo_wid_eligible=1 then do; 
if idalpha_civ_3='4' then father_id=idalpha_3; 
else if ida_civ_3='4' then father_id=ida_3; 
else if idb_civ_3='4' then father_id=idb_3; 
else if idc_civ_3='4' then father_id=idc_3; 
else if idd_civ_3='4' then father_id=idd_3; 
else if ide_civ_3='4' then father_id=ide_3; 
else if idf_civ_3='4' then father_id=idf_3; 
else if idg_civ_3='4' then father_id=idg_3; 
else if idh_civ_3='4' then father_id=idh_3; 
else if idi_civ_3='4' then father_id=idi_3; 
else if idj_civ_3='4' then father_id=idj_3; 
else if idk_civ_3='4' then father_id=idk_3; 
else if idl_civ_3='4' then father_id=idl_3; 
else if idm_civ_3='4' then father_id=idm_3; 
else if idn_civ_3='4' then father_id=idn_3; 
else if ido_civ_3='4' then father_id=ido_3; 
else if idp_civ_3='4' then father_id=idp_3; 
else if idq_civ_3='4' then father_id=idq_3; 
else if idr_civ_3='4' then father_id=idr_3; 
else if ids_civ_3='4' then father_id=ids_3; 
else if idt_civ_3='4' then father_id=idt_3; 
else if idu_civ_3='4' then father_id=idu_3; 
end; 
end; 

if (hhstate=8) then mother_id=idz_6;
if (hhstate=8) then father_id=id_6; 
if missing(mother_id) then mother_id='0'; 
if missing(father_id) then father_id='0';  
run; 







/*Maintenant on a dans notre table avec toutes les variables les différents rôles possibles dans un ménage
ainsi que des variables "identifiant du père" "identifiant de la mère" et "identifiant du concubin". 
On va maintenant préparer la base pour être traitée par liam22. */

data &library..&outdata_1.; 
set  &library..hh_position; 
keep pondera labour_market_state hhstate ch04 id household marital_status period ano4 trimestre ch06  mother_id partner_id father_id;  
run; 
proc sort data=&library..hh_position; 
 by household; 
 run; 

/*D	'abord une fois le fusionner 20032_2003_t3 pour avoir id_short. 
Puis fusionner de nouveau avec les id_long pour égaliser avec id_short, 
refusionner dans l'autre sens et obtenir les id shrinked pour partner_id*/
proc sort data=&library..&outdata_1.; 
by id; 
run; 
proc sort data=&library..temporary_id; 
by id; 
run; 
data &library..temp; 
merge &library..&outdata_1. &library..temporary_id; 
by id; 
run; 
data &library..temp; 
set &library..temp; 
id_shrinked=id_short; 
id_long=id;
run; 
data &library..temp; 
set &library..temp; 
drop codusu id componente; 
run; 
data &library..temp2; 
set &library..&outdata_1.; 
id_long=partner_id;
id_temp=id;
run; 
data &library..temp2; 
set &library..temp2;
keep id_long id_temp; 
run; 
data &library..temp2; 
set &library..temp2; 
if id_long='0' then delete; 
run; 
proc sort data=&library..temp; 
by id_long; run;; 
proc sort data=&library..temp2; 
by id_long; run; 
data &library..temp3; 
merge &library..temp2 &library..temp; 
by id_long; 
run; 
data &library..temp4; 
set &library..temp3; 
keep id_long id_short id_temp; 
run; 
data &library..temp4; 
set &library..temp4; 
if missing(id_temp) then delete; 
short_p_id=id_short; 
run;
data &library..temp4; 
set &library..temp4;
drop id_long; 
run; 
data &library..temp4; 
set &library..temp4; 
id_long=id_temp; 
drop id_temp; 
run; 




proc sort data=&library..temp3; 
by id_long; 
run; 

proc sort data=&library..temp4; 
by id_long; 
run; 
data &library..temp5;
merge &library..temp4 &library..temp3; 
by id_long; 
run;  
/*ENFIN! Maintenant on a l'identifiant court pour le partenaire. On va renommer tout ça pour le rendre liam2 compatible à terme*/
data &library..temp5; 
set &library..temp5; 
if missing(short_p_id) then short_p_id=-1;
drop id_temp partner_id ;  
run; 
/*Maintenant la même chose pour mother_id*/

data &library..temp2b; 
set &library..&outdata_1.; 
id_temp=id;
id_temp2=mother_id;
run; 
proc sort data=&library..temp2b; 
by id_temp2; 
run; 
data &library..temp2ab; 
set &library..temp2b; 
by id_temp2;
if last.id_temp2; 
run; 
data &library..temp2ab; 
set &library..temp2ab;
keep id_temp2 id_temp ; 
run; 
data &library..tempb; 
set &library..temp; 
id_temp2=id_long; 
run;  
proc sort data=&library..tempb; 
by id_temp2;
run; 
proc sort data=&library..temp2ab; 
by id_temp2; run; 
data &library..temp3b; 
merge &library..tempb &library..temp2ab; 
by id_temp2; 
run;
 
data &library..temp4b; 
set &library..temp3b; 
keep id_temp2  id_short ; 
run; 
data &library..temp4b; 
set &library..temp4b; 
short_m_id=id_short; 
mother_id=id_temp2;
run; 
data &library..temp4b; 
set &library..temp4b; 
drop id_short id_temp2; 
run; 
proc sort data=&library..temp4b; 
by mother_id; 
run; 
proc sort data=&library..tempb; 
by mother_id; 
run; 
data &library..temp5b;
merge &library..tempb &library..temp4b; 
by mother_id;
run;  
proc sort data=&library..temp5b; 
by id_long; 
run; 
data &library..temp5b; 
set &library..temp5b;
if missing(id_long) then delete; 
run;  
data &library..temp5b; 
set &library..temp5b; 
if missing(short_m_id) then short_m_id=-1; 
run; 




/*Et on raccourcit l'identifiant pour le père aussi*/

data &library..temp2c; 
set &library..&outdata_1.; 
id_temp=id;
id_temp2=father_id;
run; 
proc sort data=&library..temp2c; 
by id_temp2; 
run; 
data &library..temp2abc; 
set &library..temp2c; 
by id_temp2;
if last.id_temp2; 
run; 
data &library..temp2abc; 
set &library..temp2abc;
keep id_temp2 id_temp ; 
run; 
data &library..tempc; 
set &library..temp; 
id_temp2=id_long; 
run;  
proc sort data=&library..tempc; 
by id_temp2;
run; 
proc sort data=&library..temp2abc; 
by id_temp2; run; 
data &library..temp3c; 
merge &library..tempc &library..temp2abc; 
by id_temp2; 
run;
 
data &library..temp4c; 
set &library..temp3c; 
keep id_temp2  id_short ; 
run; 
data &library..temp4c; 
set &library..temp4c; 
short_f_id=id_short; 
father_id=id_temp2;
run; 
data &library..temp4c; 
set &library..temp4c; 
drop id_short id_temp2; 
run; 
proc sort data=&library..temp4c; 
by father_id; 
run; 
proc sort data=&library..tempc; 
by father_id; 
run; 
data &library..temp5c;
merge &library..tempc &library..temp4c; 
by father_id;
run;   
proc sort data=&library..temp5c; 
by id_long; 
run; 
data &library..temp5c; 
set &library..temp5c;
if missing(id_long) then delete; 
run;  
data &library..temp5c; 
set &library..temp5c; 
if missing(short_f_id) then short_f_id=-1; 
run; 
/*Maintenant on merge les bases avec les identifiants raccourcis pour les mères, les pères et les partenaires*/
proc sort data=&library..temp5; 
by id_long; 
run; 
proc sort data=&library..temp5b; 
by id_long; 
run; 

proc sort data=&library..temp5c; 
by id_long; 
run; 
data &library..&outdata_2.;
merge &library..temp5 &library..temp5b &library..temp5c; 
by id_long; 
/*et pour mother_id c'est BON! */
if missing(id_short) then delete; 
run; 
/*Maintenant on a dans notre table avec toutes les variables les différents rôles possibles dans un ménage
ainsi que des variables "identifiant du père" "identifiant de la mère" et "identifiant du concubin". 
On va maintenant préparer la base pour être traitée par liam22. */
proc sort data=&library..&outdata_2.; 
by household; 
run; 
data &library..&outdata_2.; 
set &library..&outdata_2.; 
keep household id_short id_long short_p_id short_m_id short_f_id mother_id father_id partner_id id_shrinked; 
run; 
data &library..&outdata_3._hh; 
set &library..&outdata_2.; 
by household;
if last.household; 
run; 

data household;
set &library..&outdata_2.;  
by household; 
if last.household;
run; 
proc sort data=household; 
by household; 
run; 
data household;
set household; 
by household; 
	temp+1; 
	household_short=temp-1; 
run; 
data household; 
set household; 
keep household household_short; 
ruN; 

data &library..&outdata_3._hh; 
merge &library..&outdata_3._hh household; 
by household; 
run; 
data &library..&outdata_3._hh; 
set &library..&outdata_3._hh; 
keep pondera household household_short ano4 trimestre period ;
period=&period_2.;  
run; 


proc sort data=&library..&outdata_2.; 
by household; 
run; 
data &library..&outdata_2.; 
merge &library..&outdata_2. household; 
	by household; 
	period=&period.; 
run; 
data &library..tempfua; 
set &library..&outdata_2.; 
drop household id_long mother_id partner_id father_id;  
run; 
data &library..&outdata_3.; 
set &library..tempfua; 
id=id_short; 
household=household_short; 
mother_id=short_m_id; 
partner_id=short_p_id;
father_id=short_f_id;  
run; 
/*data &library..&outdata_3.; 
set &library..tempfua; 
keep pondera agegroup labour_market_state formation hhstate ch04 id household marital_status period ano4  ch06  mother_id partner_id father_id;  
run; */
proc sort data=&library..&outdata_3.; 
by id; 
run; 
data &library..&outdata_3.; 
set &library..&outdata_3.;
period=&period.;  
run; 
data &library..&outdata_3.; 
set &library..&outdata_3.; 
by  id ;  
if first.id  then apparition=1; 
else apparition+1;
run;
data &library..&outdata_3.; 
set &library..&outdata_3.; 
if apparition ^=1 then delete; 
drop apparition; 
run; 
%mend; 
=======
/*The logic behind this macro is laid out in Appendix I of the thesis*/

/*Macro for putting at zero missing values*/
 %Macro M_Zero (ds) ;
     data &ds. (drop=_i);
          set &ds. ;
          array A_VarNum[*] _NUMERIC_ ;     

          do _i=1 to dim( A_VarNum ) ;
          If A_VarNum (_i)=. then A_VarNum (_i)=0 ;
     End ;
   run ;
%Mend ; 

%macro family_links_and_id_post_2016 (library,indata,quarter,outdata_1,outdata_2,outdata_3,period,period_2);  
dm 'clear log';
dm 'odsresults; clear';  
options nofmterr; 
data &library..&indata.; 
set &library..&indata.; 
	id=person; 
run; 
proc sort data=&library..&indata.; 
	by id; 
run; 
data &library..temporary_base; 
set &library..&indata.; 
	where trimestre=&quarter.; 
 if ch03=01 then hhstate=1; 
 if ch03=02 then hhstate=2;
 if ch03=03 then hhstate=3; 
 if ch03=04 then hhstate=4; 
 if ch03=05 then hhstate=5; 
 if ch03=06 then hhstate=6; 
 if ch03=07 then hhstate=7; 
 if ch03=08 then hhstate=8; 
 if ch03=09 then hhstate=9; 
 if ch03=10 then hhstate=10;  
 if ch07=1 then marital_status=1; 
 if ch07=2 then marital_status=2; 
 if ch07=3 then marital_status=3; 
 if ch07=4 then marital_status=4; 
 if ch07=5 then marital_status=5;
 run; 
 

data  &library..temporary_base; 
set  &library..temporary_base; 
	by id; 
		temp_id+1;
		id_short=temp_id-1; 
	drop temp_id;
run; 
 data &library..temporary_id; 
 set &library..temporary_base; 
 ruN; 
data &library..indata_bis; 
 set &library..temporary_base; 
 keep period household id hhstate marital_status ch04 ano4 trimestre;
 run; 

 data &library..temporary_base; 
 set &library..temporary_base; 
keep household componente hhstate ch04 marital_status;
run; 
data &library..temporary_base; 
set &library..temporary_base; 
idza_1=cats(household,1); idzb_1=cats(household,2);
idza_2=cats(household,1);idzb_2=cats(household,2);  
idzalpha_3=cats(household,2);  idza_3=cats(household,3);idzb_3=cats(household,4);idzc_3=cats(household,5);idzd_3=cats(household,6);idze_3=cats(household,7);idzf_3=cats(household,8);idzg_3=cats(household,9);idzh_3=cats(household,10);idzi_3=cats(household,11);idzj_3=cats(household,12);idzk_3=cats(household,13);idzl_3=cats(household,14);idzm_3=cats(household,15);idzn_3=cats(household,16);

idzalpha_4=cats(household,2); idza_4=cats(household,3);idzb_4=cats(household,4);idzc_4=cats(household,5);idzd_4=cats(household,6);idze_4=cats(household,7);idzf_4=cats(household,8);idzg_4=cats(household,9);idzh_4=cats(household,10);idzi_4=cats(household,11);idzj_4=cats(household,12);idzk_4=cats(household,14);idzl_4=cats(household,14);idzm_4=cats(household,15);idzn_4=cats(household,16);idzo_4=cats(household,17);idzp_4=cats(household,18);
idzalpha_5=cats(household,2);idza_5=cats(household,3);idzb_5=cats(household,5);idzc_5=cats(household,5);idzd_5=cats(household,6);idze_5=cats(household,7);idzf_5=cats(household,8);idzg_5=cats(household,9);idzh_5=cats(household,10);idzi_5=cats(household,11);idzj_5=cats(household,12);idzk_5=cats(household,15);idzl_5=cats(household,15);idzm_5=cats(household,15);idzn_5=cats(household,16);idzo_5=cats(household,17);idzp_5=cats(household,18);idzq_5=cats(household,19);idzr_5=cats(household,20);idzs_5=cats(household,21);idzt_5=cats(household,22);
idzalpha_6=cats(household,2);idza_6=cats(household,3);idzb_6=cats(household,5);idzc_6=cats(household,5);idzd_6=cats(household,6);idze_6=cats(household,7);idzf_6=cats(household,8);idzg_6=cats(household,9);idzh_6=cats(household,10);idzi_6=cats(household,11);idzj_6=cats(household,12);idzk_6=cats(household,15);idzl_6=cats(household,15);idzm_6=cats(household,15);idzn_6=cats(household,16);idzo_6=cats(household,17);idzp_6=cats(household,18);idzq_6=cats(household,19);idzr_6=cats(household,20);idzs_6=cats(household,21);idzt_6=cats(household,22);
idzalpha_7=cats(household,2);idza_7=cats(household,3);idzb_7=cats(household,5);idzc_7=cats(household,5);idzd_7=cats(household,6);idze_7=cats(household,7);idzf_7=cats(household,8);idzg_7=cats(household,9);idzh_7=cats(household,10);idzi_7=cats(household,11);idzj_7=cats(household,12);idzk_7=cats(household,15);idzl_7=cats(household,15);idzm_7=cats(household,15);idzn_7=cats(household,16);idzo_7=cats(household,17);idzp_7=cats(household,18);idzq_7=cats(household,19);idzr_7=cats(household,20);idzs_7=cats(household,21);idzt_7=cats(household,22);
idzalpha_8=cats(household,2);idza_8=cats(household,3);idzb_8=cats(household,5);idzc_8=cats(household,5);idzd_8=cats(household,6);idze_8=cats(household,7);idzf_8=cats(household,8);idzg_8=cats(household,9);idzh_8=cats(household,10);idzi_8=cats(household,11);idzj_8=cats(household,12);idzk_8=cats(household,15);idzl_8=cats(household,15);idzm_8=cats(household,15);idzn_8=cats(household,16);idzo_8=cats(household,17);idzp_8=cats(household,18);idzq_8=cats(household,19);idzr_8=cats(household,20);idzs_8=cats(household,21);idzt_8=cats(household,22);
idzalpha_9=cats(household,2);idza_9=cats(household,3);idzb_9=cats(household,5);idzc_9=cats(household,5);idzd_9=cats(household,6);idze_9=cats(household,7);idzf_9=cats(household,8);idzg_9=cats(household,9);idzh_9=cats(household,10);idzi_9=cats(household,11);idzj_9=cats(household,12);idzk_9=cats(household,15);idzl_9=cats(household,15);idzm_9=cats(household,15);idzn_9=cats(household,16);idzo_9=cats(household,17);idzp_9=cats(household,18);idzq_9=cats(household,19);idzr_9=cats(household,20);idzs_9=cats(household,21);idzt_9=cats(household,22);
idzalpha_10=cats(household,2);idza_10=cats(household,3);idzb_10=cats(household,5);idzc_10=cats(household,5);idzd_10=cats(household,6);idze_10=cats(household,7);idzf_10=cats(household,8);idzg_10=cats(household,9);idzh_10=cats(household,10);idzi_10=cats(household,11);idzj_10=cats(household,12);idzk_10=cats(household,15);idzl_10=cats(household,15);idzm_10=cats(household,15);idzn_10=cats(household,16);idzo_10=cats(household,17);idzp_10=cats(household,18);idzq_10=cats(household,19);idzr_10=cats(household,20);idzs_10=cats(household,21);idzt_10=cats(household,22);
idz51=cats(household,51);
idz71=cats(household,71);  
 ida_1=cats(household,1);idb_1=cats(household,2);
ida_2=cats(household,1);idb_2=cats(household,2);  
idalpha_3=cats(household,2); ida_3=cats(household,3);idb_3=cats(household,4);idc_3=cats(household,5);idd_3=cats(household,6);ide_3=cats(household,7);idf_3=cats(household,8);idg_3=cats(household,9);idh_3=cats(household,10);idi_3=cats(household,11);idj_3=cats(household,12);idk_3=cats(household,13);idl_3=cats(household,14);idm_3=cats(household,15);idn_3=cats(household,16);
idalpha_4=cats(household,2);
ida_4=cats(household,3);idb_4=cats(household,4);idc_4=cats(household,5);idd_4=cats(household,6);ide_4=cats(household,7);idf_4=cats(household,8);idg_4=cats(household,9);idh_4=cats(household,10);idi_4=cats(household,11);idj_4=cats(household,12);idk_4=cats(household,14);idl_4=cats(household,14);idm_4=cats(household,15);idn_4=cats(household,16);ido_4=cats(household,17);idp_4=cats(household,18);
idalpha_5=cats(household,2);
ida_5=cats(household,3);idb_5=cats(household,5);idc_5=cats(household,5);idd_5=cats(household,6);ide_5=cats(household,7);idf_5=cats(household,8);idg_5=cats(household,9);idh_5=cats(household,10);idi_5=cats(household,11);idj_5=cats(household,12);idk_5=cats(household,15);idl_5=cats(household,15);idm_5=cats(household,15);idn_5=cats(household,16);ido_5=cats(household,17);idp_5=cats(household,18);idq_5=cats(household,19);idr_5=cats(household,20);ids_5=cats(household,21);idt_5=cats(household,22);
idalpha_6=cats(household,2);
ida_6=cats(household,3);idb_6=cats(household,5);idc_6=cats(household,5);idd_6=cats(household,6);ide_6=cats(household,7);idf_6=cats(household,8);idg_6=cats(household,9);idh_6=cats(household,10);idi_6=cats(household,11);idj_6=cats(household,12);idk_6=cats(household,15);idl_6=cats(household,15);idm_6=cats(household,15);idn_6=cats(household,16);ido_6=cats(household,17);idp_6=cats(household,18);idq_6=cats(household,19);idr_6=cats(household,20);ids_6=cats(household,21);idt_6=cats(household,22);
idalpha_7=cats(household,2); 
ida_7=cats(household,3);idb_7=cats(household,5);idc_7=cats(household,5);idd_7=cats(household,6);ide_7=cats(household,7);idf_7=cats(household,8);idg_7=cats(household,9);idh_7=cats(household,10);idi_7=cats(household,11);idj_7=cats(household,12);idk_7=cats(household,15);idl_7=cats(household,15);idm_7=cats(household,15);idn_7=cats(household,16);ido_7=cats(household,17);idp_7=cats(household,18);idq_7=cats(household,19);idr_7=cats(household,20);ids_7=cats(household,21);idt_7=cats(household,22);
idalpha_8=cats(household,2); 
ida_8=cats(household,3);idb_8=cats(household,5);idc_8=cats(household,5);idd_8=cats(household,6);ide_8=cats(household,7);idf_8=cats(household,8);idg_8=cats(household,9);idh_8=cats(household,10);idi_8=cats(household,11);idj_8=cats(household,12);idk_8=cats(household,15);idl_8=cats(household,15);idm_8=cats(household,15);idn_8=cats(household,16);ido_8=cats(household,17);idp_8=cats(household,18);idq_8=cats(household,19);idr_8=cats(household,20);ids_8=cats(household,21);idt_8=cats(household,22);
idalpha_9=cats(household,2); 
ida_9=cats(household,3);idb_9=cats(household,5);idc_9=cats(household,5);idd_9=cats(household,6);ide_9=cats(household,7);idf_9=cats(household,8);idg_9=cats(household,9);idh_9=cats(household,10);idi_9=cats(household,11);idj_9=cats(household,12);idk_9=cats(household,15);idl_9=cats(household,15);idm_9=cats(household,15);idn_9=cats(household,16);ido_9=cats(household,17);idp_9=cats(household,18);idq_9=cats(household,19);idr_9=cats(household,20);ids_9=cats(household,21);idt_9=cats(household,22);
idalpha_10=cats(household,2); 
ida_10=cats(household,3);idb_10=cats(household,5);idc_10=cats(household,5);idd_10=cats(household,6);ide_10=cats(household,7);idf_10=cats(household,8);idg_10=cats(household,9);idh_10=cats(household,10);idi_10=cats(household,11);idj_10=cats(household,12);idk_10=cats(household,15);idl_10=cats(household,15);idm_10=cats(household,15);idn_10=cats(household,16);ido_10=cats(household,17);idp_10=cats(household,18);idq_10=cats(household,19);idr_10=cats(household,20);ids_10=cats(household,21);idt_10=cats(household,22);
id51=cats(household,51);
id71=cats(household,71);  
run; 

 data &library..id_component1; 
set &library..temporary_base (where=((hhstate=1)&(componente=1)&(ch04=1)));
keep household ida_1 ; 
run;  

data &library..id_component2; 
set &library..temporary_base (where=((hhstate=1)&(componente=2)&(ch04=1)));
keep household idb_1 ; 
run;  
data &library..id_componentz1; 
set &library..temporary_base (where=((hhstate=1)&(componente=1)&(ch04=2)));
keep household idza_1 ; 
run;  

data &library..id_componentz2; 
set &library..temporary_base (where=((hhstate=1)&(componente=2)&(ch04=2)));
keep household idzb_1 ; 
run;  
proc sort data=&library..indata_bis; 
	by household; 
run; 
data &library..hh_position_1; 
merge &library..indata_bis &library..id_component1 &library..id_component2 &library..id_componentz1 &library..id_componentz2; 
by household; 
run; 
data &library..hh_position_1; 
set &library..hh_position_1; 
if (hhstate=1) &(componente=1)&(ch04=1) then ida_1='1';
if (hhstate=1) &(componente=2)&(ch04=1) then idb_1='1'; 
if (hhstate=1) &(componente=1)&(ch04=2) then idza_1='1';
if (hhstate=1) &(componente=2)&(ch04=2) then idzb_1='1'; 
if missing(ida_1) then ida_1='0'; 
if missing(idb_1) then idb_1='0'; 
if (ida_1^='0')&(ida_1^='1') then jefe_id=ida_1; 
if (idb_1^='0')&(idb_1^='1') then jefe_id=idb_1; 
if hhstate=1 then jefe_id='1'; 

if missing(ida_1) then ida_1='0'; 
if missing(idb_1) then idb_1='0'; 

if missing(idza_1) then idza_1='0'; 
if missing(idzb_1) then idzb_1='0'; 
if (idza_1^='0')&(idza_1^='1') then jefe_id=idza_1; 
if (idzb_1^='0')&(idzb_1^='1') then jefe_id=idzb_1; 
if hhstate=1 then jefe_id='1'; 

run;  
/*Voilà: on a défini la variable jefe_id. ´Nous on veut in fine avoir la variable mother_id. 
Concrètement, la mère peut se trouver en hhid=1 | hhid=2 | hhid=3 |hhid=4 |hhid=6 |hhid=7. 
Pour l'instant on va lancer aussi la variable partenaire_id.;*/
data &library..id_component1; 
set &library..temporary_base (where=((hhstate=2)&(componente=1)&(ch04=1)));
keep household ida_2 ; 
run;  

data &library..id_component2; 
set &library..temporary_base (where=((hhstate=2)&(componente=2)&(ch04=1)));
keep household idb_2 ; 
run;  
data &library..id_componentz1; 
set &library..temporary_base (where=((hhstate=2)&(componente=1)&(ch04=2)));
keep household idza_2 ; 
run;  

data &library..id_componentz2; 
set &library..temporary_base (where=((hhstate=2)&(componente=2)&(ch04=2)));
keep household idzb_2 ; 
run;  

data &library..hh_position_2; 
merge &library..indata_bis &library..id_component1 &library..id_component2 &library..id_componentz1 &library..id_componentz2; 
by household; 
run; 
data &library..hh_position_2; 
set &library..hh_position_2; 
if (hhstate=2) &(componente=1)&(ch04=1) then ida_2='1';
if (hhstate=2) &(componente=2)&(ch04=1) then idb_2='1'; 
if (hhstate=2) &(componente=1)&(ch04=2) then idza_2='1';
if (hhstate=2) &(componente=2)&(ch04=2) then idzb_2='1';
if missing(ida_2) then ida_2='0'; 
if missing(idb_2) then idb_2='0'; 
if (ida_2^='0')&(ida_2^='1') then partenaire_id=ida_2; 
if (idb_2^='0')&(idb_2^='1') then partenaire_id=idb_2; 
if hhstate=2 then partenaire_id='1';  
if missing(partenaire_id) then partenaire_id='0';
 
if missing(idza_2) then idza_2='0'; 
if missing(idzb_2) then idzb_2='0'; 
if (idza_2^='0')&(idza_2^='1') then partenaire_id=idza_2; 
if (idzb_2^='0')&(idzb_2^='1') then partenaire_id=idzb_2; 
if hhstate=2 then partenaire_id='1';  
if missing(partenaire_id) then partenaire_id='0'; 
run;  
/*This macro makes missing values equal 0*/
 %Macro M_Zero (ds) ;
     data &ds. (drop=_i);
          set &ds. ;
          array A_VarNum[*] _NUMERIC_ ;     

          do _i=1 to dim( A_VarNum ) ;
          If A_VarNum (_i)=. then A_VarNum (_i)=0 ;
     End ;
   run ;
%Mend ; 


%macro hhstate2(hhstate);

data &library..id_componentalpha; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=2)&(ch04=1)));
keep household idalpha_&hhstate. marital_status; 
run;  
data &library..id_componentalpha; 
set &library..id_componentalpha; 
rename marital_status=idalpha_civ_&hhstate.; 
ruN; 
data &library..id_componenta; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=3)&(ch04=1)));
keep household ida_&hhstate. marital_status; 
run;  
data &library..id_componenta; 
set &library..id_componenta; 
rename marital_status=ida_civ_&hhstate.; 
ruN; 
data &library..id_componentb; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=4)&(ch04=1)));
keep household idb_&hhstate. marital_status; 
run;  
data &library..id_componentb; 
set &library..id_componentb; 
rename marital_status=idb_civ_&hhstate.; 
ruN; 
data &library..id_componentc; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=5)&(ch04=1)));
keep household idc_&hhstate. marital_status; 
run;  
data &library..id_componentc; 
set &library..id_componentc; 
rename marital_status=idc_civ_&hhstate.; 
ruN; 
data &library..id_componentd; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=6)&(ch04=1)));
keep household idd_&hhstate. marital_status; 
run;  
data &library..id_componentd; 
set &library..id_componentd; 
rename marital_status=idd_civ_&hhstate.; 
ruN; 
data &library..id_componente; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=7)&(ch04=1)));
keep household ide_&hhstate. marital_status; 
run;  
data &library..id_componente; 
set &library..id_componente; 
rename marital_status=ide_civ_&hhstate.; 
ruN; 
data &library..id_componentf; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=8)&(ch04=1)));
keep household idf_&hhstate. marital_status; 
run;  
data &library..id_componentf; 
set &library..id_componentf; 
rename marital_status=idf_civ_&hhstate.; 
ruN; 
data &library..id_componentg; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=9)&(ch04=1)));
keep household idg_&hhstate. marital_status; 
run;  
data &library..id_componentg; 
set &library..id_componentg; 
rename marital_status=idg_civ_&hhstate.; 
ruN; 
data &library..id_componenth; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=10)&(ch04=1)));
keep household idh_&hhstate. marital_status; 
run;  
data &library..id_componenth; 
set &library..id_componenth; 
rename marital_status=idh_civ_&hhstate.; 
ruN; 
data &library..id_componenti; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=11)&(ch04=1)));
keep household idi_&hhstate. marital_status; 
run;  
data &library..id_componenti; 
set &library..id_componenti; 
rename marital_status=idi_civ_&hhstate.; 
ruN; 
data &library..id_componentj; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=12)&(ch04=1)));
keep household idj_&hhstate. marital_status; 
run;  
data &library..id_componentj; 
set &library..id_componentj; 
rename marital_status=idj_civ_&hhstate.; 
ruN; 
data &library..id_componentk; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=13)&(ch04=1)));
keep household idk_&hhstate. marital_status; 
run;  
data &library..id_componentk; 
set &library..id_componentk; 
rename marital_status=idk_civ_&hhstate.; 
ruN; 
data &library..id_componentl; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=14)&(ch04=1)));
keep household idl_&hhstate. marital_status; 
run;  
data &library..id_componentl; 
set &library..id_componentl; 
rename marital_status=idl_civ_&hhstate.; 
ruN; 
data &library..id_componentm; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=15)&(ch04=1)));
keep household idm_&hhstate. marital_status; 
run;  
data &library..id_componentm; 
set &library..id_componentm; 
rename marital_status=idm_civ_&hhstate.; 
ruN; 

data &library..id_componentn; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=16)&(ch04=1)));
keep household idn_&hhstate. marital_status; 
run;  
data &library..id_componentn; 
set &library..id_componentn; 
rename marital_status=idn_civ_&hhstate.; 
ruN; 
data &library..id_componento; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=17)&(ch04=1)));
keep household ido_&hhstate. marital_status; 
run;  
data &library..id_componento; 
set &library..id_componento; 
rename marital_status=ido_civ_&hhstate.; 
ruN; 
data &library..id_componentp; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=18)&(ch04=1)));
keep household idp_&hhstate. marital_status; 
run; 
data &library..id_componentp; 
set &library..id_componentp; 
rename marital_status=idp_civ_&hhstate.; 
ruN; 
data &library..id_componentq; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=19)&(ch04=1)));
keep household idq_&hhstate. marital_status; 
run;  
data &library..id_componentq; 
set &library..id_componentq; 
rename marital_status=idq_civ_&hhstate.; 
ruN; 
data &library..id_componentr; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=20)&(ch04=1)));
keep household idr_&hhstate. marital_status; 
run;  
data &library..id_componentr; 
set &library..id_componentr; 
rename marital_status=idr_civ_&hhstate.; 
ruN; 
data &library..id_components; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=21)&(ch04=1)));
keep household ids_&hhstate. marital_status; 
run;  
data &library..id_components; 
set &library..id_components; 
rename marital_status=ids_civ_&hhstate.; 
ruN; 
data &library..id_componentt; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=22)&(ch04=1)));
keep household idt_&hhstate. marital_status; 
run;  
data &library..id_componentt; 
set &library..id_componentt; 
rename marital_status=idt_civ_&hhstate.; 
ruN; 
data &library..id_componentu; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=23)&(ch04=1)));
keep household idu_&hhstate. marital_status; 
run;  
data &library..id_componentu; 
set &library..id_componentu; 
rename marital_status=idu_civ_&hhstate.; 
ruN; 

data &library..id_componentzalpha; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=2)&(ch04=2)));
keep household idzalpha_&hhstate. marital_status; 
run;  
data &library..id_componentzalpha; 
set &library..id_componentzalpha; 
rename marital_status=idzalpha_civ_&hhstate.; 
ruN; 

data &library..id_componentza; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=3)&(ch04=2)));
keep household idza_&hhstate. marital_status; 
run;  
data &library..id_componentza; 
set &library..id_componentza; 
rename marital_status=idza_civ_&hhstate.; 
ruN; 

data &library..id_componentzb; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=4)&(ch04=2)));
keep household idzb_&hhstate. marital_status; 
run;  
data &library..id_componentzb; 
set &library..id_componentzb; 
rename marital_status=idzb_civ_&hhstate.; 
ruN; 
data &library..id_componentzc; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=5)&(ch04=2)));
keep household idzc_&hhstate. marital_status; 
run;  
data &library..id_componentzc; 
set &library..id_componentzc; 
rename marital_status=idzc_civ_&hhstate.; 
ruN; 
data &library..id_componentzd; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=6)&(ch04=2)));
keep household idzd_&hhstate. marital_status; 
run;  
data &library..id_componentzd; 
set &library..id_componentzd; 
rename marital_status=idzd_civ_&hhstate.; 
ruN; 
data &library..id_componentze; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=7)&(ch04=2)));
keep household idze_&hhstate. marital_status; 
run;  
data &library..id_componentze; 
set &library..id_componentze; 
rename marital_status=idze_civ_&hhstate.; 
ruN; 
data &library..id_componentzf; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=8)&(ch04=2)));
keep household idzf_&hhstate. marital_status; 
run;  
data &library..id_componentzf; 
set &library..id_componentzf; 
rename marital_status=idzf_civ_&hhstate.; 
ruN; 
data &library..id_componentzg; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=9)&(ch04=2)));
keep household idzg_&hhstate. marital_status; 
run;  
data &library..id_componentzg; 
set &library..id_componentzg; 
rename marital_status=idzg_civ_&hhstate.; 
ruN; 
data &library..id_componentzh; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=10)&(ch04=2)));
keep household idzh_&hhstate. marital_status; 
run;  
data &library..id_componentzh; 
set &library..id_componentzh; 
rename marital_status=idzh_civ_&hhstate.; 
ruN; 
data &library..id_componentzi; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=11)&(ch04=2)));
keep household idzi_&hhstate. marital_status; 
run;  
data &library..id_componentzi; 
set &library..id_componentzi; 
rename marital_status=idzi_civ_&hhstate.; 
ruN; 
data &library..id_componentzj; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=12)&(ch04=2)));
keep household idzj_&hhstate. marital_status; 
run;  
data &library..id_componentzj; 
set &library..id_componentzj; 
rename marital_status=idzj_civ_&hhstate.; 
ruN; 
data &library..id_componentzk; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=13)&(ch04=2)));
keep household idzk_&hhstate. marital_status; 
run;  
data &library..id_componentzk; 
set &library..id_componentzk; 
rename marital_status=idzk_civ_&hhstate.; 
ruN; 
data &library..id_componentzl; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=14)&(ch04=2)));
keep household idzl_&hhstate. marital_status; 
run;  
data &library..id_componentzl; 
set &library..id_componentzl; 
rename marital_status=idzl_civ_&hhstate.; 
ruN; 
data &library..id_componentzm; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=15)&(ch04=2)));
keep household idzm_&hhstate. marital_status; 
run;  

data &library..id_componentzm; 
set &library..id_componentzm; 
rename marital_status=idzm_civ_&hhstate.; 
ruN; 
data &library..id_componentzn; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=16)&(ch04=2)));
keep household idzn_&hhstate. marital_status; 
run;  
data &library..id_componentzn; 
set &library..id_componentzn; 
rename marital_status=idzn_civ_&hhstate.; 
ruN; 
data &library..id_componentzo; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=17)&(ch04=2)));
keep household idzo_&hhstate. marital_status; 
run;  
data &library..id_componentzo; 
set &library..id_componentzo; 
rename marital_status=idzo_civ_&hhstate.; 
ruN; 
data &library..id_componentzp; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=18)&(ch04=2)));
keep household idzp_&hhstate. marital_status; 
run; 
data &library..id_componentzp; 
set &library..id_componentzp; 
rename marital_status=idzp_civ_&hhstate.; 
ruN; 
data &library..id_componentzq; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=19)&(ch04=2)));
keep household idzq_&hhstate. marital_status; 
run;  
data &library..id_componentzq; 
set &library..id_componentzq; 
rename marital_status=idzq_civ_&hhstate.; 
ruN; 
data &library..id_componentzr; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=20)&(ch04=2)));
keep household idzr_&hhstate. marital_status; 
run;  
data &library..id_componentzr; 
set &library..id_componentzr; 
rename marital_status=idzr_civ_&hhstate.; 
ruN; 
data &library..id_componentzs; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=21)&(ch04=2)));
keep household idzs_&hhstate. marital_status; 
run;  
data &library..id_componentzs; 
set &library..id_componentzs; 
rename marital_status=idzs_civ_&hhstate.; 
ruN; 
data &library..id_componentzt; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=22)&(ch04=2)));
keep household idzt_&hhstate. marital_status; 
run;  
data &library..id_componentzt; 
set &library..id_componentzt; 
rename marital_status=idzt_civ_&hhstate.; 
ruN; 
data &library..id_componentzu; 
set &library..temporary_base (where=((hhstate=&hhstate.)&(componente=23)&(ch04=2)));
keep household idzu_&hhstate. marital_status; 
run;  
data &library..id_componentzu; 
set &library..id_componentzu; 
rename marital_status=idzu_civ_&hhstate.; 
ruN; 


data &library..hh_position_&hhstate.; 
merge &library..indata_bis &library..id_componentalpha &library..id_componenta &library..id_componentb &library..id_componentc &library..id_componentd 
&library..id_componente &library..id_componentf &library..id_componentg &library..id_componenth &library..id_componenti &library..id_componentj 
&library..id_componentk &library..id_componentl &library..id_componentm &library..id_componentn &library..id_componento &library..id_componentp &library..id_componentq  
&library..id_componentr &library..id_components &library..id_componentt &library..id_componentu &library..id_componentzalpha
&library..id_componentza &library..id_componentzb &library..id_componentzc &library..id_componentzd 
&library..id_componentze &library..id_componentzf &library..id_componentzg &library..id_componentzh &library..id_componentzi &library..id_componentzj 
&library..id_componentzk &library..id_componentzl &library..id_componentzm &library..id_componentzn &library..id_componentzo &library..id_componentzp &library..id_componentzq  
&library..id_componentzr &library..id_componentzs &library..id_componentzt &library..id_componentzu;
by household; 
run; 
data &library..hh_position_&hhstate.; 
set &library..hh_position_&hhstate.; 
if (hhstate=&hhstate.) &(componente=2)&(ch04=1) then idalpha_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=3)&(ch04=1) then ida_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=4)&(ch04=1) then idb_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=5)&(ch04=1) then idc_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=6)&(ch04=1) then idd_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=7)&(ch04=1) then ide_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=8)&(ch04=1) then idf_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=9)&(ch04=1) then idg_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=10)&(ch04=1) then idh_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=11)&(ch04=1) then idi_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=12)&(ch04=1) then idj_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=13)&(ch04=1) then idk_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=14)&(ch04=1) then idl_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=15)&(ch04=1) then idm_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=16)&(ch04=1) then idn_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=17)&(ch04=1) then ido_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=18)&(ch04=1) then idp_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=19)&(ch04=1) then idq_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=20)&(ch04=1) then idr_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=21)&(ch04=1) then ids_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=22)&(ch04=1) then idt_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=23)&(ch04=1) then idu_&hhstate.='1';

 if (hhstate=&hhstate.) &(componente=2)&(ch04=2) then idzalpha_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=3)&(ch04=2) then idza_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=4)&(ch04=2) then idzb_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=5)&(ch04=2) then idzc_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=6)&(ch04=2) then idzd_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=7)&(ch04=2) then idze_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=8)&(ch04=2) then idzf_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=9)&(ch04=2) then idzg_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=10)&(ch04=2) then idzh_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=11)&(ch04=2) then idzi_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=12)&(ch04=2) then idzj_&hhstate.='1';
if (hhstate=&hhstate.) &(componente=13)&(ch04=2) then idzk_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=14)&(ch04=2) then idzl_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=15)&(ch04=2) then idzm_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=16)&(ch04=2) then idzn_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=17)&(ch04=2) then idzo_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=18)&(ch04=2) then idzp_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=19)&(ch04=2) then idzq_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=20)&(ch04=2) then idzr_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=21)&(ch04=2) then idzs_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=22)&(ch04=2) then idzt_&hhstate.='1';
 if (hhstate=&hhstate.) &(componente=23)&(ch04=2) then idzu_&hhstate.='1';
if missing(idalpha_&hhstate.) then idalpha_&hhstate.='0'; 
if (idalpha_&hhstate.^='0')&(idalpha_&hhstate.^='1') then id_&hhstate.=idalpha_&hhstate.; 
if missing(ida_&hhstate.) then ida_&hhstate.='0'; 
if (ida_&hhstate.^='0')&(ida_&hhstate.^='1') then id_&hhstate.=ida_&hhstate.; 
if missing(idb_&hhstate.) then idb_&hhstate.='0'; 
if (idb_&hhstate.^='0')&(idb_&hhstate.^='1') then id_&hhstate.=idb_&hhstate.; 
if missing(idc_&hhstate.) then idc_&hhstate.='0'; 
if (idc_&hhstate.^='0')&(idc_&hhstate.^='1') then id_&hhstate.=idc_&hhstate.; 
if missing(idd_&hhstate.) then idd_&hhstate.='0'; 
if (idd_&hhstate.^='0')&(idd_&hhstate.^='1') then id_&hhstate.=idd_&hhstate.; 
if missing(ide_&hhstate.) then ide_&hhstate.='0'; 
if (ide_&hhstate.^='0')&(ide_&hhstate.^='1') then id_&hhstate.=ide_&hhstate.; 
if missing(idf_&hhstate.) then idf_&hhstate.='0'; 
if (idf_&hhstate.^='0')&(idf_&hhstate.^='1') then id_&hhstate.=idf_&hhstate.; 
if missing(idg_&hhstate.) then idg_&hhstate.='0'; 
if (idg_&hhstate.^='0')&(idg_&hhstate.^='1') then id_&hhstate.=idg_&hhstate.; 
if missing(idh_&hhstate.) then idh_&hhstate.='0'; 
if (idh_&hhstate.^='0')&(idh_&hhstate.^='1') then id_&hhstate.=idh_&hhstate.; 
if missing(idi_&hhstate.) then idi_&hhstate.='0'; 
if (idi_&hhstate.^='0')&(idi_&hhstate.^='1') then id_&hhstate.=idi_&hhstate.; 
if missing(idj_&hhstate.) then idj_&hhstate.='0'; 
if (idj_&hhstate.^='0')&(idj_&hhstate.^='1') then id_&hhstate.=idj_&hhstate.; 
if missing(idk_&hhstate.) then idk_&hhstate.='0'; 
if (idk_&hhstate.^='0')&(idk_&hhstate.^='1') then id_&hhstate.=idk_&hhstate.;
if missing(idl_&hhstate.) then idl_&hhstate.='0'; 
if (idl_&hhstate.^='0')&(idl_&hhstate.^='1') then id_&hhstate.=idl_&hhstate.;
if missing(idm_&hhstate.) then idm_&hhstate.='0'; 
if (idm_&hhstate.^='0')&(idm_&hhstate.^='1') then id_&hhstate.=idm_&hhstate.;  
if missing(idn_&hhstate.) then idn_&hhstate.='0'; 
if (idn_&hhstate.^='0')&(idn_&hhstate.^='1') then id_&hhstate.=idn_&hhstate.; 
if missing(ido_&hhstate.) then ido_&hhstate.='0'; 
if (ido_&hhstate.^='0')&(ido_&hhstate.^='1') then id_&hhstate.=ido_&hhstate.; 
if missing(idp_&hhstate.) then idp_&hhstate.='0'; 
if (idp_&hhstate.^='0')&(idp_&hhstate.^='1') then id_&hhstate.=idp_&hhstate.; 
if missing(idq_&hhstate.) then idq_&hhstate.='0'; 
if (idq_&hhstate.^='0')&(idq_&hhstate.^='1') then id_&hhstate.=idq_&hhstate.;
if missing(idr_&hhstate.) then idr_&hhstate.='0'; 
if (idr_&hhstate.^='0')&(idr_&hhstate.^='1') then id_&hhstate.=idr_&hhstate.;
if missing(ids_&hhstate.) then ids_&hhstate.='0'; 
if (ids_&hhstate.^='0')&(ids_&hhstate.^='1') then id_&hhstate.=ids_&hhstate.; 
if missing(idt_&hhstate.) then idt_&hhstate.='0'; 
if (idt_&hhstate.^='0')&(idt_&hhstate.^='1') then id_&hhstate.=idt_&hhstate.;  
if missing(idu_&hhstate.) then idu_&hhstate.='0'; 
if (idu_&hhstate.^='0')&(idu_&hhstate.^='1') then id_&hhstate.=idu_&hhstate.;  
if hhstate=&hhstate. then id_&hhstate.='1';  
if missing(id_&hhstate.) then id_&hhstate.='0'; 

if missing(idzalpha_&hhstate.) then idzalpha_&hhstate.='0'; 
if (idzalpha_&hhstate.^='0')&(idzalpha_&hhstate.^='1') then idz_&hhstate.=idzalpha_&hhstate.; 
if missing(idza_&hhstate.) then idza_&hhstate.='0'; 
if (idza_&hhstate.^='0')&(idza_&hhstate.^='1') then idz_&hhstate.=idza_&hhstate.; 
if missing(idzb_&hhstate.) then idzb_&hhstate.='0'; 
if (idzb_&hhstate.^='0')&(idzb_&hhstate.^='1') then idz_&hhstate.=idzb_&hhstate.; 
if missing(idzc_&hhstate.) then idzc_&hhstate.='0'; 
if (idzc_&hhstate.^='0')&(idzc_&hhstate.^='1') then idz_&hhstate.=idzc_&hhstate.; 
if missing(idzd_&hhstate.) then idzd_&hhstate.='0'; 
if (idzd_&hhstate.^='0')&(idzd_&hhstate.^='1') then idz_&hhstate.=idzd_&hhstate.; 
if missing(idze_&hhstate.) then idze_&hhstate.='0'; 
if (idze_&hhstate.^='0')&(idze_&hhstate.^='1') then idz_&hhstate.=idze_&hhstate.; 
if missing(idzf_&hhstate.) then idzf_&hhstate.='0'; 
if (idzf_&hhstate.^='0')&(idzf_&hhstate.^='1') then idz_&hhstate.=idzf_&hhstate.; 
if missing(idzg_&hhstate.) then idzg_&hhstate.='0'; 
if (idzg_&hhstate.^='0')&(idzg_&hhstate.^='1') then idz_&hhstate.=idzg_&hhstate.; 
if missing(idzh_&hhstate.) then idzh_&hhstate.='0'; 
if (idzh_&hhstate.^='0')&(idzh_&hhstate.^='1') then idz_&hhstate.=idzh_&hhstate.; 
if missing(idzi_&hhstate.) then idzi_&hhstate.='0'; 
if (idzi_&hhstate.^='0')&(idzi_&hhstate.^='1') then idz_&hhstate.=idzi_&hhstate.; 
if missing(idzj_&hhstate.) then idzj_&hhstate.='0'; 
if (idzj_&hhstate.^='0')&(idzj_&hhstate.^='1') then idz_&hhstate.=idzj_&hhstate.; 
if missing(idzk_&hhstate.) then idzk_&hhstate.='0'; 
if (idzk_&hhstate.^='0')&(idzk_&hhstate.^='1') then idz_&hhstate.=idzk_&hhstate.;
if missing(idzl_&hhstate.) then idzl_&hhstate.='0'; 
if (idzl_&hhstate.^='0')&(idzl_&hhstate.^='1') then idz_&hhstate.=idzl_&hhstate.;
if missing(idzm_&hhstate.) then idzm_&hhstate.='0'; 
if (idzm_&hhstate.^='0')&(idzm_&hhstate.^='1') then idz_&hhstate.=idzm_&hhstate.;  
if missing(idzn_&hhstate.) then idzn_&hhstate.='0'; 
if (idzn_&hhstate.^='0')&(idzn_&hhstate.^='1') then idz_&hhstate.=idzn_&hhstate.; 
if missing(idzo_&hhstate.) then idzo_&hhstate.='0'; 
if (idzo_&hhstate.^='0')&(idzo_&hhstate.^='1') then idz_&hhstate.=idzo_&hhstate.; 
if missing(idzp_&hhstate.) then idzp_&hhstate.='0'; 
if (idzp_&hhstate.^='0')&(idzp_&hhstate.^='1') then idz_&hhstate.=idzp_&hhstate.; 
if missing(idzq_&hhstate.) then idzq_&hhstate.='0'; 
if (idzq_&hhstate.^='0')&(idzq_&hhstate.^='1') then idz_&hhstate.=idzq_&hhstate.;
if missing(idzr_&hhstate.) then idzr_&hhstate.='0'; 
if (idzr_&hhstate.^='0')&(idzr_&hhstate.^='1') then idz_&hhstate.=idzr_&hhstate.;
if missing(idzs_&hhstate.) then idzs_&hhstate.='0'; 
if (idzs_&hhstate.^='0')&(idzs_&hhstate.^='1') then idz_&hhstate.=idzs_&hhstate.; 
if missing(idzt_&hhstate.) then idzt_&hhstate.='0'; 
if (idzt_&hhstate.^='0')&(idzt_&hhstate.^='1') then idz_&hhstate.=idzt_&hhstate.;  
if missing(idzu_&hhstate.) then idzu_&hhstate.='0'; 
if (idzu_&hhstate.^='0')&(idzu_&hhstate.^='1') then idz_&hhstate.=idzu_&hhstate.;  
if hhstate=&hhstate. then idz_&hhstate.='1';  
if missing(idz_&hhstate.) then idz_&hhstate.='0'; 
run;  
%m_zero(&library..hh_position_&hhstate.); 
%mend; 


%hhstate2(3);%hhstate2(4);%hhstate2(5);%hhstate2(6);%hhstate2(7);%hhstate2(8);%hhstate2(9);%hhstate2(10);
proc sort data=&library..hh_position_1; 
by id; 
run; 
proc sort data=&library..hh_position_2; 
by id; 
run; 
proc sort data=&library..hh_position_3; 
by id; 
run; 
proc sort data=&library..hh_position_4; 
by id; 
run; 
proc sort data=&library..hh_position_5; 
by id; 
run; 
proc sort data=&library..hh_position_6; 
by id; 
run; 
proc sort data=&library..hh_position_7; 
by id; 
run; 
proc sort data=&library..hh_position_8; 
by id; 
run; 
proc sort data=&library..hh_position_9; 
by id; 
run; 
proc sort data=&library..hh_position_10; 
by id; 
run; 
data &library..hh_position; 
merge &library..hh_position_1-&library..hh_position_10; 
by id; 
run;
data &library..id_component1; 
set &library..temporary_base (where=(componente=51));
keep household id51;
run;  
data &library..id_component2; 
set &library..temporary_base (where=(componente=71));
keep household id71 ; 
run;  
proc sort data=&library..hh_position; by household; run; 
data &library..hh_position; 
merge &library..hh_position &library..id_component1 &library..id_component2; 
by household; 
run; 
data &library..hh_position; 
set &library..hh_position; 
if (hhstate=1) &(componente=51) then id51='1';
if (hhstate=1) &(componente=71) then id71='1'; 
if missing(id51) then id51='0'; 
if missing(id71) then id71='0'; 
if (id51^='0')&(id51^='1') then id_10=id51; 
if (id71^='0')&(id71^='1') then id_10=id71; 
if hhstate=10 then id_10='1';  
if missing(id_10) then id_10='0'; 
run;  
proc sort data=&library..hh_position; 
by household; 
run; 
proc freq data=&library..hh_position noprint ; 
by household; 
tables hhstate*ch04*marital_status /out=&library..temp;
table hhstate /out=&library..temp2; 
table ch04 /out=&library..temp3; 
table marital_status /out=&library..temp4; 
run;
data &library..temp; 
set &library..temp;
if marital_status=5 then unknown_parents=0; 
if count<=1 then unknown_parents=0; 
if hhstate=3 then do; 
if marital_status^=5 & count>1 then unknown_parents=1;
if count<=1 then do; 
unknown_parents=0; 
if marital_status=1 & ch04=1 then tag_uni_h=1; 
else tag_uni_h=0; 
if marital_status=1 & ch04=2 THEN tag_uni_f=1; 
else tag_uni_f=0; 
if marital_status=2 & ch04=1 then tag_cas_h=1; 
else tag_cas_h=0; 
if marital_status=2 & ch04=2 THEN tag_cas_f=1; 
else tag_cas_f=0;
if marital_status=3 & ch04=1 then tag_div_h=1; 
else tag_div_h=0; 
if marital_status=3 & ch04=2 THEN tag_div_f=1; 
else tag_div_f=0; 
if marital_status=4 & ch04=1 then tag_wid_h=1; 
else tag_wid_h=0; 
if marital_status=4 & ch04=2 THEN tag_wid_f=1; 
else tag_wid_f=0; 
end; end; 
if hhstate^=3 then do; 
unknown_parents=0; 
tag_uni_h=0; 
tag_uni_f=0; 
tag_wid_h=0; 
tag_wid_f=0; 
tag_cas_h=0; 
tag_cas_f=0; 
tag_div_h=0; 
tag_div_f=0; 
end; 
 

if (marital_status=1|marital_status=2)& ch04=1 & hhstate=3 & count=1 then hijo_eligible=1; 
else hijo_eligible=0; 
if (marital_status=1|marital_status=2)& ch04=2 & hhstate=3 & count=1 then hija_eligible=1; 
else hija_eligible=0; 
if (marital_status=1|marital_status=2)& ch04=1 & hhstate=4 & count=1 then yerno_eligible=1; 
else yerno_eligible=0; 
if (marital_status=1|marital_status=2)& ch04=2 & hhstate=4 & count=1 then nuera_eligible=1; 
else nuera_eligible=0; 
if (marital_status=1)& ch04=1 & hhstate=3 & count=1 then hijo_uni_eligible=1; 
else hijo_uni_eligible=0; 
if (marital_status=1)& ch04=2 & hhstate=3 & count=1 then hija_uni_eligible=1; 
else hija_uni_eligible=0; 
if (marital_status=1)& ch04=1 & hhstate=4 & count=1 then yerno_uni_eligible=1; 
else yerno_uni_eligible=0; 
if (marital_status=1)& ch04=2 & hhstate=4 & count=1 then nuera_uni_eligible=1; 
else nuera_uni_eligible=0; 
if (marital_status=2)& ch04=1 & hhstate=3 & count=1 then hijo_cas_eligible=1; 
else hijo_cas_eligible=0; 
if (marital_status=2)& ch04=2 & hhstate=3 & count=1 then hija_cas_eligible=1; 
else hija_cas_eligible=0; 
if (marital_status=2)& ch04=1 & hhstate=4 & count=1 then yerno_cas_eligible=1; 
else yerno_cas_eligible=0; 
if (marital_status=2)& ch04=2 & hhstate=4 & count=1 then nuera_cas_eligible=1; 
else nuera_cas_eligible=0; 
if hijo_eligible=0 & hija_eligible=0 & yerno_eligible=0 & nuera_eligible=0 then do; 
if (marital_status=3|marital_status=4)& ch04=1 & hhstate=3 & count=1 then hijo_eligible_2=1; 
else hijo_eligible_2=0; 
if (marital_status=3|marital_status=4)& ch04=2 & hhstate=3 & count=1 then hija_eligible_2=1; 
else hija_eligible_2=0; 
if (marital_status=3)& ch04=1 & hhstate=3 & count=1 then hijo_div_eligible=1; 
else hijo_div_eligible=0; 
if (marital_status=3)& ch04=2 & hhstate=3 & count=1 then hija_div_eligible=1; 
else hija_div_eligible=0; 
if (marital_status=4)& ch04=1 & hhstate=3 & count=1 then hijo_wid_eligible=1; 
else hijo_wid_eligible=0; 
if (marital_status=4)& ch04=2 & hhstate=3 & count=1 then hija_wid_eligible=1; 
else hija_wid_eligible=0; 
end; 
else do; 
hijo_eligible_2=0; 
hija_eligible_2=0; 
hijo_div_eligible=0; 
hija_div_eligible=0; 
hijo_wid_eligible=0; 
hija_wid_eligible=0; 
end; 
ruN; 
data &library..temp_tag_a; 
set &library..temp; 
where unknown_parents=1; 
keep household unknown_parents; 
run; 
data &library..temp_tag_b; 
set &library..temp; 
where 
tag_uni_h=1; 
keep household tag_uni_h; 
run; 
data &library..temp_tag_c; 
set &library..temp; 
where 
tag_uni_f=1; 
keep household tag_uni_f; 
run; 
data &library..temp_tag_d; 
set &library..temp; 
where 
tag_cas_h=1; 
keep household tag_cas_h; 
run; 
data &library..temp_tag_e; 
set &library..temp; 
where 
tag_cas_f=1; 
keep household tag_cas_f; 
run; 
data &library..temp_tag_f; 
set &library..temp; 
where 
tag_div_h=1; 
keep household tag_div_h; 
run; 
data &library..temp_tag_g; 
set &library..temp; 
where 
tag_div_f=1; 
keep household tag_div_f; 
run; 

data &library..temp_tag_h; 
set &library..temp; 
where 
tag_wid_h=1; 
keep household tag_wid_h; 
run; 
data &library..temp_tag_i; 
set &library..temp; 
where 
tag_wid_f=1; 
keep household tag_wid_f; 
run; 
data &library..tempa; 
set &library..temp; 
where hijo_eligible=1; 
keep household hijo_eligible; 
run; 
data &library..tempb; 
set &library..temp; 
where hija_eligible=1; 
keep household hija_eligible; 
run; 
data &library..tempc; 
set &library..temp; 
where yerno_eligible=1; 
keep household yerno_eligible; 
run; 
data &library..tempd; 
set &library..temp; 
where nuera_eligible=1; 
keep household nuera_eligible; 
run; 
data &library..temp_uni_a; 
set &library..temp; 
where hijo_uni_eligible=1;
keep household hijo_uni_eligible;  
run; 
data &library..temp_uni_b; 
set &library..temp; 
where hija_uni_eligible=1; 
keep household hija_uni_eligible; 
run; 
data &library..temp_uni_c; 
set &library..temp; 
where yerno_uni_eligible=1; 
keep household yerno_uni_eligible; 
run; 
data &library..temp_uni_d; 
set &library..temp; 
where nuera_uni_eligible=1; 
keep household nuera_uni_eligible; 
run; 
data &library..temp_cas_a; 
set &library..temp; 
where hijo_cas_eligible=1; 
keep household hijo_cas_eligible; 
run; 
data &library..temp_cas_b; 
set &library..temp; 
where hija_cas_eligible=1;
keep household hija_cas_eligible;  
run; 
data &library..temp_cas_c; 
set &library..temp; 
where yerno_cas_eligible=1; 
keep household yerno_cas_eligible; 
run; 
data &library..temp_cas_d; 
set &library..temp; 
where nuera_cas_eligible=1; 
keep household nuera_cas_eligible; 
run; 


data &library..tempe; 
set &library..temp; 
where hijo_eligible_2=1; 
keep household hijo_eligible_2; 
run; 
data &library..tempf; 
set &library..temp; 
where hija_eligible_2=1; 
keep household hija_eligible_2; 
run; 
data &library..tempe_div; 
set &library..temp; 
where hijo_div_eligible=1; 
keep household hijo_div_eligible; 
run; 
data &library..tempf_div; 
set &library..temp; 
where hija_div_eligible=1; 
keep household hija_div_eligible; 
run; 
data &library..tempe_wid; 
set &library..temp; 
where hijo_wid_eligible=1; 
keep household hijo_wid_eligible; 
run; 
data &library..tempf_wid; 
set &library..temp; 
where hija_wid_eligible=1; 
keep household hija_wid_eligible; 
run; /*
data &library..save; 
set &library..hh_position; 
run; */
data &library..hh_position; 
set &library..hh_position; 
drop unknown_parents; run; 
proc sort data=&library..hh_position; 
by household; 
run; 
data &library..hh_position; 
merge &library..hh_position &library..tempa &library..tempb &library..tempc &library..tempd &library..temp_uni_a &library..temp_uni_b &library..temp_uni_c &library..temp_uni_d  &library..temp_cas_a &library..temp_cas_b &library..temp_cas_c &library..temp_cas_d &library..tempe &library..tempf &library..tempe_div &library..tempf_div &library..tempe_wid &library..tempf_wid
&library..temp_tag_a &library..temp_tag_b &library..temp_tag_c &library..temp_tag_d &library..temp_tag_e &library..temp_tag_f &library..temp_tag_g &library..temp_tag_h &library..temp_tag_i; 
by household; 
run;
%m_zero(&library..hh_position);
proc contents data=leo.hh_position; run; 
data &library..hh_position; 
set &library..hh_position; 
tag=tag_uni_h + tag_Uni_f + tag_cas_h + tag_cas_f + tag_div_h + tag_div_f + tag_wid_h + tag_wid_f; 
if tag>1 | unknown_parents=1 then hijos_identif=0; 
if tag<=1 & unknown_parents=0 then hijos_identif=1; 
if ((hhstate=1) & (jefe_id='1')) then partner_id=partenaire_id; 
if ((hhstate=2) & (partenaire_id='1')) then partner_id=jefe_id;  
if ((hhstate=3) & (marital_status=1)&(ch04=2) & hija_uni_eligible=1)then do; 
if idalpha_civ_4='1' then partner_id=idalpha_4; 
else if ida_civ_4='1' then partner_id=ida_4; 
else if idb_civ_4='1' then partner_id=idb_4; 
else if idc_civ_4='1' then partner_id=idc_4; 
else if idd_civ_4='1' then partner_id=idd_4; 
else if ide_civ_4='1' then partner_id=ide_4; 
else if idf_civ_4='1' then partner_id=idf_4; 
else if idg_civ_4='1' then partner_id=idg_4; 
else if idh_civ_4='1' then partner_id=idh_4; 
else if idi_civ_4='1' then partner_id=idi_4; 
else if idj_civ_4='1' then partner_id=idj_4; 
else if idk_civ_4='1' then partner_id=idk_4; 
else if idl_civ_4='1' then partner_id=idl_4; 
else if idm_civ_4='1' then partner_id=idm_4; 
else if idn_civ_4='1' then partner_id=idn_4; 
else if ido_civ_4='1' then partner_id=ido_4; 
else if idp_civ_4='1' then partner_id=idp_4; 
else if idq_civ_4='1' then partner_id=idq_4; 
else if idr_civ_4='1' then partner_id=idr_4; 
else if ids_civ_4='1' then partner_id=ids_4; 
else if idt_civ_4='1' then partner_id=idt_4; 
else if idu_civ_4='1' then partner_id=idu_4; 
end; 
if ((hhstate=3) & (marital_status=2)&(ch04=2) & hija_cas_eligible=1)then do; 
if idalpha_civ_4='2' then partner_id=idalpha_4;
else if ida_civ_4='2' then partner_id=ida_4; 
else if idb_civ_4='2' then partner_id=idb_4; 
else if idc_civ_4='2' then partner_id=idc_4; 
else if idd_civ_4='2' then partner_id=idd_4; 
else if ide_civ_4='2' then partner_id=ide_4; 
else if idf_civ_4='2' then partner_id=idf_4; 
else if idg_civ_4='2' then partner_id=idg_4; 
else if idh_civ_4='2' then partner_id=idh_4; 
else if idi_civ_4='2' then partner_id=idi_4; 
else if idj_civ_4='2' then partner_id=idj_4; 
else if idk_civ_4='2' then partner_id=idk_4; 
else if idl_civ_4='2' then partner_id=idl_4; 
else if idm_civ_4='2' then partner_id=idm_4; 
else if idn_civ_4='2' then partner_id=idn_4; 
else if ido_civ_4='2' then partner_id=ido_4; 
else if idp_civ_4='2' then partner_id=idp_4; 
else if idq_civ_4='2' then partner_id=idq_4; 
else if idr_civ_4='2' then partner_id=idr_4; 
else if ids_civ_4='2' then partner_id=ids_4; 
else if idt_civ_4='2' then partner_id=idt_4; 
else if idu_civ_4='2' then partner_id=idu_4; 
end; 

if ((hhstate=3) & (marital_status=1)&(ch04=1) & hijo_uni_eligible=1)then do; 
if idzalpha_civ_4='1' then partner_id=idzalpha_4; 
else if idza_civ_4='1' then partner_id=idza_4; 
else if idzb_civ_4='1' then partner_id=idzb_4; 
else if idzc_civ_4='1' then partner_id=idzc_4; 
else if idzd_civ_4='1' then partner_id=idzd_4; 
else if idze_civ_4='1' then partner_id=idze_4; 
else if idzf_civ_4='1' then partner_id=idzf_4; 
else if idzg_civ_4='1' then partner_id=idzg_4; 
else if idzh_civ_4='1' then partner_id=idzh_4; 
else if idzi_civ_4='1' then partner_id=idzi_4; 
else if idzj_civ_4='1' then partner_id=idzj_4; 
else if idzk_civ_4='1' then partner_id=idzk_4; 
else if idzl_civ_4='1' then partner_id=idzl_4; 
else if idzm_civ_4='1' then partner_id=idzm_4; 
else if idzn_civ_4='1' then partner_id=idzn_4; 
else if idzo_civ_4='1' then partner_id=idzo_4; 
else if idzp_civ_4='1' then partner_id=idzp_4; 
else if idzq_civ_4='1' then partner_id=idzq_4; 
else if idzr_civ_4='1' then partner_id=idzr_4; 
else if idzs_civ_4='1' then partner_id=idzs_4; 
else if idzt_civ_4='1' then partner_id=idzt_4; 
else if idzu_civ_4='1' then partner_id=idzu_4; 
end; 
if ((hhstate=3) & (marital_status=2)&(ch04=1) & hijo_cas_eligible=1)then do; 
if idzalpha_civ_4='2' then partner_id=idzalpha_4; 
else if idza_civ_4='2' then partner_id=idza_4; 
else if idzb_civ_4='2' then partner_id=idzb_4; 
else if idzc_civ_4='2' then partner_id=idzc_4; 
else if idzd_civ_4='2' then partner_id=idzd_4; 
else if idze_civ_4='2' then partner_id=idze_4; 
else if idzf_civ_4='2' then partner_id=idzf_4; 
else if idzg_civ_4='2' then partner_id=idzg_4; 
else if idzh_civ_4='2' then partner_id=idzh_4; 
else if idzi_civ_4='2' then partner_id=idzi_4; 
else if idzj_civ_4='2' then partner_id=idzj_4; 
else if idzk_civ_4='2' then partner_id=idzk_4; 
else if idzl_civ_4='2' then partner_id=idzl_4; 
else if idzm_civ_4='2' then partner_id=idzm_4; 
else if idzn_civ_4='2' then partner_id=idzn_4; 
else if idzo_civ_4='2' then partner_id=idzo_4; 
else if idzp_civ_4='2' then partner_id=idzp_4; 
else if idzq_civ_4='2' then partner_id=idzq_4; 
else if idzr_civ_4='2' then partner_id=idzr_4; 
else if idzs_civ_4='2' then partner_id=idzs_4; 
else if idzt_civ_4='2' then partner_id=idzt_4; 
else if idzu_civ_4='2' then partner_id=idzu_4; 
end; 

if ((hhstate=4) & (marital_status=1)&(ch04=2) & nuera_uni_eligible=1)then do; 
if idalpha_civ_3='1' then partner_id=idalpha_3; 
else if ida_civ_3='1' then partner_id=ida_3; 
else if idb_civ_3='1' then partner_id=idb_3; 
else if idc_civ_3='1' then partner_id=idc_3; 
else if idd_civ_3='1' then partner_id=idd_3; 
else if ide_civ_3='1' then partner_id=ide_3; 
else if idf_civ_3='1' then partner_id=idf_3; 
else if idg_civ_3='1' then partner_id=idg_3; 
else if idh_civ_3='1' then partner_id=idh_3; 
else if idi_civ_3='1' then partner_id=idi_3; 
else if idj_civ_3='1' then partner_id=idj_3; 
else if idk_civ_3='1' then partner_id=idk_3; 
else if idl_civ_3='1' then partner_id=idl_3; 
else if idm_civ_3='1' then partner_id=idm_3; 
else if idn_civ_3='1' then partner_id=idn_3; 
else if ido_civ_3='1' then partner_id=ido_3; 
else if idp_civ_3='1' then partner_id=idp_3; 
else if idq_civ_3='1' then partner_id=idq_3; 
else if idr_civ_3='1' then partner_id=idr_3; 
else if ids_civ_3='1' then partner_id=ids_3; 
else if idt_civ_3='1' then partner_id=idt_3; 
else if idu_civ_3='1' then partner_id=idu_3; 
end; 
if ((hhstate=4) & (marital_status=2)&(ch04=2) & nuera_cas_eligible=1)then do; 
if idalpha_civ_3='2' then partner_id=idalpha_3; 
else if ida_civ_3='2' then partner_id=ida_3; 
else if idb_civ_3='2' then partner_id=idb_3; 
else if idc_civ_3='2' then partner_id=idc_3; 
else if idd_civ_3='2' then partner_id=idd_3; 
else if ide_civ_3='2' then partner_id=ide_3; 
else if idf_civ_3='2' then partner_id=idf_3; 
else if idg_civ_3='2' then partner_id=idg_3; 
else if idh_civ_3='2' then partner_id=idh_3; 
else if idi_civ_3='2' then partner_id=idi_3; 
else if idj_civ_3='2' then partner_id=idj_3; 
else if idk_civ_3='2' then partner_id=idk_3; 
else if idl_civ_3='2' then partner_id=idl_3; 
else if idm_civ_3='2' then partner_id=idm_3; 
else if idn_civ_3='2' then partner_id=idn_3; 
else if ido_civ_3='2' then partner_id=ido_3; 
else if idp_civ_3='2' then partner_id=idp_3; 
else if idq_civ_3='2' then partner_id=idq_3; 
else if idr_civ_3='2' then partner_id=idr_3; 
else if ids_civ_3='2' then partner_id=ids_3; 
else if idt_civ_3='2' then partner_id=idt_3; 
else if idu_civ_3='2' then partner_id=idu_3; 
end; 

if ((hhstate=4) & (marital_status=1)&(ch04=1) & yerno_uni_eligible=1)then do; 
if idzalpha_civ_3='1' then partner_id=idzalpha_3; 
else if idza_civ_3='1' then partner_id=idza_3;
else if idzb_civ_3='1' then partner_id=idzb_3; 
else if idzc_civ_3='1' then partner_id=idzc_3; 
else if idzd_civ_3='1' then partner_id=idzd_3; 
else if idze_civ_3='1' then partner_id=idze_3; 
else if idzf_civ_3='1' then partner_id=idzf_3; 
else if idzg_civ_3='1' then partner_id=idzg_3; 
else if idzh_civ_3='1' then partner_id=idzh_3; 
else if idzi_civ_3='1' then partner_id=idzi_3; 
else if idzj_civ_3='1' then partner_id=idzj_3; 
else if idzk_civ_3='1' then partner_id=idzk_3; 
else if idzl_civ_3='1' then partner_id=idzl_3; 
else if idzm_civ_3='1' then partner_id=idzm_3; 
else if idzn_civ_3='1' then partner_id=idzn_3; 
else if idzo_civ_3='1' then partner_id=idzo_3; 
else if idzp_civ_3='1' then partner_id=idzp_3; 
else if idzq_civ_3='1' then partner_id=idzq_3; 
else if idzr_civ_3='1' then partner_id=idzr_3; 
else if idzs_civ_3='1' then partner_id=idzs_3; 
else if idzt_civ_3='1' then partner_id=idzt_3; 
else if idzu_civ_3='1' then partner_id=idzu_3; 
end; 
if ((hhstate=4) & (marital_status=2)&(ch04=1) & yerno_cas_eligible=1)then do; 
if idzalpha_civ_3='2' then partner_id=idzalpha_3;
else if idza_civ_3='2' then partner_id=idza_3;  
else if idzb_civ_3='2' then partner_id=idzb_3; 
else if idzc_civ_3='2' then partner_id=idzc_3; 
else if idzd_civ_3='2' then partner_id=idzd_3; 
else if idze_civ_3='2' then partner_id=idze_3; 
else if idzf_civ_3='2' then partner_id=idzf_3; 
else if idzg_civ_3='2' then partner_id=idzg_3; 
else if idzh_civ_3='2' then partner_id=idzh_3; 
else if idzi_civ_3='2' then partner_id=idzi_3; 
else if idzj_civ_3='2' then partner_id=idzj_3; 
else if idzk_civ_3='2' then partner_id=idzk_3; 
else if idzl_civ_3='2' then partner_id=idzl_3; 
else if idzm_civ_3='2' then partner_id=idzm_3; 
else if idzn_civ_3='2' then partner_id=idzn_3; 
else if idzo_civ_3='2' then partner_id=idzo_3; 
else if idzp_civ_3='2' then partner_id=idzp_3; 
else if idzq_civ_3='2' then partner_id=idzq_3; 
else if idzr_civ_3='2' then partner_id=idzr_3; 
else if idzs_civ_3='2' then partner_id=idzs_3; 
else if idzt_civ_3='2' then partner_id=idzt_3; 
else if idzu_civ_3='2' then partner_id=idzu_3; 
end; 
if ((hhstate=6)& (id_6^='1')&(ch04=2)) then partner_id=id_6; 
if ((hhstate=6)& (idz_6^='1')&(ch04=1)) then partner_id=idz_6;
if ((hhstate=7) & (id_7^='1') & (ch04=2)) then partner_id=id_7;
if ((hhstate=7) & (idz_7^='1') & (ch04=1)) then partner_id=idz_7;
if missing(partner_id) then partner_id='0';  
if missing(idza_1) then idza_1='0'; 
if missing(ida_1) then ida_1='0'; 
if ((hhstate=1) & (jefe_id='1')) then mother_id=idz_6; 
if ((hhstate=1) & (jefe_id='1')) then father_id=id_6; 
if ((hhstate=2) & (partner_id='1')) then mother_id=idz_7;
if ((hhstate=2) & (partner_id='1')) then father_id=id_7; 

if ((hhstate=3)&(idza_1^='0')&(idzb_1='0')) then mother_id=idza_1;
if ((hhstate=3)&(idza_1='0')&(idzb_1^='0')) then mother_id=idzb_1;
if ((hhstate=3)&(ida_1^='0')&(idb_1='0')) then father_id=ida_1;
if ((hhstate=3)&(ida_1='0')&(idb_1^='0')) then father_id=idb_1;

if ((hhstate=3)&(idza_2^='0')&(idzb_2='0')) then mother_id=idza_2;
if ((hhstate=3)&(idza_2='0')&(idzb_2^='0')) then mother_id=idzb_2;
if ((hhstate=3)&(ida_2^='0')&(idb_2='0')) then father_id=ida_2;
if ((hhstate=3)&(ida_2='0')&(idb_2^='0')) then father_id=idb_2;
if hhstate=5 & hijos_identif=1 then do; 
if hija_uni_eligible=1 then do; 
if idzalpha_civ_3='1' then mother_id=idzalpha_3; 
else if idza_civ_3='1' then mother_id=idza_3; 
else if idzb_civ_3='1' then mother_id=idzb_3; 
else if idzc_civ_3='1' then mother_id=idzc_3; 
else if idzd_civ_3='1' then mother_id=idzd_3; 
else if idze_civ_3='1' then mother_id=idze_3; 
else if idzf_civ_3='1' then mother_id=idzf_3; 
else if idzg_civ_3='1' then mother_id=idzg_3; 
else if idzh_civ_3='1' then mother_id=idzh_3; 
else if idzi_civ_3='1' then mother_id=idzi_3; 
else if idzj_civ_3='1' then mother_id=idzj_3; 
else if idzk_civ_3='1' then mother_id=idzk_3; 
else if idzl_civ_3='1' then mother_id=idzl_3; 
else if idzm_civ_3='1' then mother_id=idzm_3; 
else if idzn_civ_3='1' then mother_id=idzn_3; 
else if idzo_civ_3='1' then mother_id=idzo_3; 
else if idzp_civ_3='1' then mother_id=idzp_3; 
else if idzq_civ_3='1' then mother_id=idzq_3; 
else if idzr_civ_3='1' then mother_id=idzr_3; 
else if idzs_civ_3='1' then mother_id=idzs_3; 
else if idzt_civ_3='1' then mother_id=idzt_3; 
else if idzu_civ_3='1' then mother_id=idzu_3; 
end; 
if hijo_uni_eligible=1 then do; 
if idalpha_civ_3='1' then father_id=idalpha_3; 
else if ida_civ_3='1' then father_id=ida_3; 
else if idb_civ_3='1' then father_id=idb_3; 
else if idc_civ_3='1' then father_id=idc_3; 
else if idd_civ_3='1' then father_id=idd_3; 
else if ide_civ_3='1' then father_id=ide_3; 
else if idf_civ_3='1' then father_id=idf_3; 
else if idg_civ_3='1' then father_id=idg_3; 
else if idh_civ_3='1' then father_id=idh_3; 
else if idi_civ_3='1' then father_id=idi_3; 
else if idj_civ_3='1' then father_id=idj_3; 
else if idk_civ_3='1' then father_id=idk_3; 
else if idl_civ_3='1' then father_id=idl_3; 
else if idm_civ_3='1' then father_id=idm_3; 
else if idn_civ_3='1' then father_id=idn_3; 
else if ido_civ_3='1' then father_id=ido_3; 
else if idp_civ_3='1' then father_id=idp_3; 
else if idq_civ_3='1' then father_id=idq_3; 
else if idr_civ_3='1' then father_id=idr_3; 
else if ids_civ_3='1' then father_id=ids_3; 
else if idt_civ_3='1' then father_id=idt_3; 
else if idu_civ_3='1' then father_id=idu_3; 
end; 
if hija_cas_eligible=1 then do; 
if idzalpha_civ_3='2' then mother_id=idzalpha_3;
else if idza_civ_3='2' then mother_id=idza_3; 
else if idzb_civ_3='2' then mother_id=idzb_3; 
else if idzc_civ_3='2' then mother_id=idzc_3; 
else if idzd_civ_3='2' then mother_id=idzd_3; 
else if idze_civ_3='2' then mother_id=idze_3; 
else if idzf_civ_3='2' then mother_id=idzf_3; 
else if idzg_civ_3='2' then mother_id=idzg_3; 
else if idzh_civ_3='2' then mother_id=idzh_3; 
else if idzi_civ_3='2' then mother_id=idzi_3; 
else if idzj_civ_3='2' then mother_id=idzj_3; 
else if idzk_civ_3='2' then mother_id=idzk_3; 
else if idzl_civ_3='2' then mother_id=idzl_3; 
else if idzm_civ_3='2' then mother_id=idzm_3; 
else if idzn_civ_3='2' then mother_id=idzn_3; 
else if idzo_civ_3='2' then mother_id=idzo_3; 
else if idzp_civ_3='2' then mother_id=idzp_3; 
else if idzq_civ_3='2' then mother_id=idzq_3; 
else if idzr_civ_3='2' then mother_id=idzr_3; 
else if idzs_civ_3='2' then mother_id=idzs_3; 
else if idzt_civ_3='2' then mother_id=idzt_3; 
else if idzu_civ_3='2' then mother_id=idzu_3; 
end; 
if hijo_cas_eligible=1 then do; 
if idalpha_civ_3='2' then father_id=idalpha_3; 
else if ida_civ_3='2' then father_id=ida_3; 
else if idb_civ_3='2' then father_id=idb_3; 
else if idc_civ_3='2' then father_id=idc_3; 
else if idd_civ_3='2' then father_id=idd_3; 
else if ide_civ_3='2' then father_id=ide_3; 
else if idf_civ_3='2' then father_id=idf_3; 
else if idg_civ_3='2' then father_id=idg_3; 
else if idh_civ_3='2' then father_id=idh_3; 
else if idi_civ_3='2' then father_id=idi_3; 
else if idj_civ_3='2' then father_id=idj_3; 
else if idk_civ_3='2' then father_id=idk_3; 
else if idl_civ_3='2' then father_id=idl_3; 
else if idm_civ_3='2' then father_id=idm_3; 
else if idn_civ_3='2' then father_id=idn_3; 
else if ido_civ_3='2' then father_id=ido_3; 
else if idp_civ_3='2' then father_id=idp_3; 
else if idq_civ_3='2' then father_id=idq_3; 
else if idr_civ_3='2' then father_id=idr_3; 
else if ids_civ_3='2' then father_id=ids_3; 
else if idt_civ_3='2' then father_id=idt_3; 
else if idu_civ_3='2' then father_id=idu_3; 
end; 
if nuera_uni_eligible=1 then do; 
if idzalpha_civ_4='1' then mother_id=idzalpha_4; 
else if idza_civ_4='1' then mother_id=idza_4; 
else if idzb_civ_4='1' then mother_id=idzb_4; 
else if idzc_civ_4='1' then mother_id=idzc_4; 
else if idzd_civ_4='1' then mother_id=idzd_4; 
else if idze_civ_4='1' then mother_id=idze_4; 
else if idzf_civ_4='1' then mother_id=idzf_4; 
else if idzg_civ_4='1' then mother_id=idzg_4; 
else if idzh_civ_4='1' then mother_id=idzh_4; 
else if idzi_civ_4='1' then mother_id=idzi_4; 
else if idzj_civ_4='1' then mother_id=idzj_4; 
else if idzk_civ_4='1' then mother_id=idzk_4; 
else if idzl_civ_4='1' then mother_id=idzl_4; 
else if idzm_civ_4='1' then mother_id=idzm_4; 
else if idzn_civ_4='1' then mother_id=idzn_4; 
else if idzo_civ_4='1' then mother_id=idzo_4; 
else if idzp_civ_4='1' then mother_id=idzp_4; 
else if idzq_civ_4='1' then mother_id=idzq_4; 
else if idzr_civ_4='1' then mother_id=idzr_4; 
else if idzs_civ_4='1' then mother_id=idzs_4; 
else if idzt_civ_4='1' then mother_id=idzt_4; 
else if idzu_civ_4='1' then mother_id=idzu_4; 
end; 
if yerno_uni_eligible=1 then do; 
if idalpha_civ_4='1' then father_id=idalpha_4; 
else if ida_civ_4='1' then father_id=ida_4; 
else if idb_civ_4='1' then father_id=idb_4; 
else if idc_civ_4='1' then father_id=idc_4; 
else if idd_civ_4='1' then father_id=idd_4; 
else if ide_civ_4='1' then father_id=ide_4; 
else if idf_civ_4='1' then father_id=idf_4; 
else if idg_civ_4='1' then father_id=idg_4; 
else if idh_civ_4='1' then father_id=idh_4; 
else if idi_civ_4='1' then father_id=idi_4; 
else if idj_civ_4='1' then father_id=idj_4; 
else if idk_civ_4='1' then father_id=idk_4; 
else if idl_civ_4='1' then father_id=idl_4; 
else if idm_civ_4='1' then father_id=idm_4; 
else if idn_civ_4='1' then father_id=idn_4; 
else if ido_civ_4='1' then father_id=ido_4; 
else if idp_civ_4='1' then father_id=idp_4; 
else if idq_civ_4='1' then father_id=idq_4; 
else if idr_civ_4='1' then father_id=idr_4; 
else if ids_civ_4='1' then father_id=ids_4; 
else if idt_civ_4='1' then father_id=idt_4; 
else if idu_civ_4='1' then father_id=idu_4; 
end; 
if nuera_cas_eligible=1 then do; 
if idzalpha_civ_4='2' then mother_id=idzalpha_4;
else if idza_civ_4='2' then mother_id=idza_4; 
else if idzb_civ_4='2' then mother_id=idzb_4; 
else if idzc_civ_4='2' then mother_id=idzc_4; 
else if idzd_civ_4='2' then mother_id=idzd_4; 
else if idze_civ_4='2' then mother_id=idze_4; 
else if idzf_civ_4='2' then mother_id=idzf_4; 
else if idzg_civ_4='2' then mother_id=idzg_4; 
else if idzh_civ_4='2' then mother_id=idzh_4; 
else if idzi_civ_4='2' then mother_id=idzi_4; 
else if idzj_civ_4='2' then mother_id=idzj_4; 
else if idzk_civ_4='2' then mother_id=idzk_4; 
else if idzl_civ_4='2' then mother_id=idzl_4; 
else if idzm_civ_4='2' then mother_id=idzm_4; 
else if idzn_civ_4='2' then mother_id=idzn_4; 
else if idzo_civ_4='2' then mother_id=idzo_4; 
else if idzp_civ_4='2' then mother_id=idzp_4; 
else if idzq_civ_4='2' then mother_id=idzq_4; 
else if idzr_civ_4='2' then mother_id=idzr_4; 
else if idzs_civ_4='2' then mother_id=idzs_4; 
else if idzt_civ_4='2' then mother_id=idzt_4; 
else if idzu_civ_4='2' then mother_id=idzu_4; 
end; 
if yerno_cas_eligible=1 then do; 
if idalpha_civ_4='2' then father_id=idalpha_4; 
else if ida_civ_4='2' then father_id=ida_4; 
else if idb_civ_4='2' then father_id=idb_4; 
else if idc_civ_4='2' then father_id=idc_4; 
else if idd_civ_4='2' then father_id=idd_4; 
else if ide_civ_4='2' then father_id=ide_4; 
else if idf_civ_4='2' then father_id=idf_4; 
else if idg_civ_4='2' then father_id=idg_4; 
else if idh_civ_4='2' then father_id=idh_4; 
else if idi_civ_4='2' then father_id=idi_4; 
else if idj_civ_4='2' then father_id=idj_4; 
else if idk_civ_4='2' then father_id=idk_4; 
else if idl_civ_4='2' then father_id=idl_4; 
else if idm_civ_4='2' then father_id=idm_4; 
else if idn_civ_4='2' then father_id=idn_4; 
else if ido_civ_4='2' then father_id=ido_4; 
else if idp_civ_4='2' then father_id=idp_4; 
else if idq_civ_4='2' then father_id=idq_4; 
else if idr_civ_4='2' then father_id=idr_4; 
else if ids_civ_4='2' then father_id=ids_4; 
else if idt_civ_4='2' then father_id=idt_4; 
else if idu_civ_4='2' then father_id=idu_4; 
end; 

 
if hija_div_eligible=1 then do; 
if idzalpha_civ_3='3' then mother_id=idzalpha_3; 
else if idza_civ_3='3' then mother_id=idza_3; 
else if idzb_civ_3='3' then mother_id=idzb_3; 
else if idzc_civ_3='3' then mother_id=idzc_3; 
else if idzd_civ_3='3' then mother_id=idzd_3; 
else if idze_civ_3='3' then mother_id=idze_3; 
else if idzf_civ_3='3' then mother_id=idzf_3; 
else if idzg_civ_3='3' then mother_id=idzg_3; 
else if idzh_civ_3='3' then mother_id=idzh_3; 
else if idzi_civ_3='3' then mother_id=idzi_3; 
else if idzj_civ_3='3' then mother_id=idzj_3; 
else if idzk_civ_3='3' then mother_id=idzk_3; 
else if idzl_civ_3='3' then mother_id=idzl_3; 
else if idzm_civ_3='3' then mother_id=idzm_3; 
else if idzn_civ_3='3' then mother_id=idzn_3; 
else if idzo_civ_3='3' then mother_id=idzo_3; 
else if idzp_civ_3='3' then mother_id=idzp_3; 
else if idzq_civ_3='3' then mother_id=idzq_3; 
else if idzr_civ_3='3' then mother_id=idzr_3; 
else if idzs_civ_3='3' then mother_id=idzs_3; 
else if idzt_civ_3='3' then mother_id=idzt_3; 
else if idzu_civ_3='3' then mother_id=idzu_3; 
end; 
if hijo_div_eligible=1 then do; 
if idalpha_civ_3='3' then father_id=idalpha_3; 
else if ida_civ_3='3' then father_id=ida_3; 
else if idb_civ_3='3' then father_id=idb_3; 
else if idc_civ_3='3' then father_id=idc_3; 
else if idd_civ_3='3' then father_id=idd_3; 
else if ide_civ_3='3' then father_id=ide_3; 
else if idf_civ_3='3' then father_id=idf_3; 
else if idg_civ_3='3' then father_id=idg_3; 
else if idh_civ_3='3' then father_id=idh_3; 
else if idi_civ_3='3' then father_id=idi_3; 
else if idj_civ_3='3' then father_id=idj_3; 
else if idk_civ_3='3' then father_id=idk_3; 
else if idl_civ_3='3' then father_id=idl_3; 
else if idm_civ_3='3' then father_id=idm_3; 
else if idn_civ_3='3' then father_id=idn_3; 
else if ido_civ_3='3' then father_id=ido_3; 
else if idp_civ_3='3' then father_id=idp_3; 
else if idq_civ_3='3' then father_id=idq_3; 
else if idr_civ_3='3' then father_id=idr_3; 
else if ids_civ_3='3' then father_id=ids_3; 
else if idt_civ_3='3' then father_id=idt_3; 
else if idu_civ_3='3' then father_id=idu_3; 
end; 

 
if hija_wid_eligible=1 then do; 
if idzalpha_civ_3='4' then mother_id=idzalpha_3; 
else if idza_civ_3='4' then mother_id=idza_3; 
else if idzb_civ_3='4' then mother_id=idzb_3; 
else if idzc_civ_3='4' then mother_id=idzc_3; 
else if idzd_civ_3='4' then mother_id=idzd_3; 
else if idze_civ_3='4' then mother_id=idze_3; 
else if idzf_civ_3='4' then mother_id=idzf_3; 
else if idzg_civ_3='4' then mother_id=idzg_3; 
else if idzh_civ_3='4' then mother_id=idzh_3; 
else if idzi_civ_3='4' then mother_id=idzi_3; 
else if idzj_civ_3='4' then mother_id=idzj_3; 
else if idzk_civ_3='4' then mother_id=idzk_3; 
else if idzl_civ_3='4' then mother_id=idzl_3; 
else if idzm_civ_3='4' then mother_id=idzm_3; 
else if idzn_civ_3='4' then mother_id=idzn_3; 
else if idzo_civ_3='4' then mother_id=idzo_3; 
else if idzp_civ_3='4' then mother_id=idzp_3; 
else if idzq_civ_3='4' then mother_id=idzq_3; 
else if idzr_civ_3='4' then mother_id=idzr_3; 
else if idzs_civ_3='4' then mother_id=idzs_3; 
else if idzt_civ_3='4' then mother_id=idzt_3; 
else if idzu_civ_3='4' then mother_id=idzu_3; 
end; 
if hijo_wid_eligible=1 then do; 
if idalpha_civ_3='4' then father_id=idalpha_3; 
else if ida_civ_3='4' then father_id=ida_3; 
else if idb_civ_3='4' then father_id=idb_3; 
else if idc_civ_3='4' then father_id=idc_3; 
else if idd_civ_3='4' then father_id=idd_3; 
else if ide_civ_3='4' then father_id=ide_3; 
else if idf_civ_3='4' then father_id=idf_3; 
else if idg_civ_3='4' then father_id=idg_3; 
else if idh_civ_3='4' then father_id=idh_3; 
else if idi_civ_3='4' then father_id=idi_3; 
else if idj_civ_3='4' then father_id=idj_3; 
else if idk_civ_3='4' then father_id=idk_3; 
else if idl_civ_3='4' then father_id=idl_3; 
else if idm_civ_3='4' then father_id=idm_3; 
else if idn_civ_3='4' then father_id=idn_3; 
else if ido_civ_3='4' then father_id=ido_3; 
else if idp_civ_3='4' then father_id=idp_3; 
else if idq_civ_3='4' then father_id=idq_3; 
else if idr_civ_3='4' then father_id=idr_3; 
else if ids_civ_3='4' then father_id=ids_3; 
else if idt_civ_3='4' then father_id=idt_3; 
else if idu_civ_3='4' then father_id=idu_3; 
end; 
end; 

if (hhstate=8) then mother_id=idz_6;
if (hhstate=8) then father_id=id_6; 
if missing(mother_id) then mother_id='0'; 
if missing(father_id) then father_id='0';  
run; 







/*Maintenant on a dans notre table avec toutes les variables les différents rôles possibles dans un ménage
ainsi que des variables "identifiant du père" "identifiant de la mère" et "identifiant du concubin". 
On va maintenant préparer la base pour être traitée par liam22. */

data &library..&outdata_1.; 
set  &library..hh_position; 
keep pondera labour_market_state hhstate ch04 id household marital_status period ano4 trimestre ch06  mother_id partner_id father_id;  
run; 
proc sort data=&library..hh_position; 
 by household; 
 run; 

/*D	'abord une fois le fusionner 20032_2003_t3 pour avoir id_short. 
Puis fusionner de nouveau avec les id_long pour égaliser avec id_short, 
refusionner dans l'autre sens et obtenir les id shrinked pour partner_id*/
proc sort data=&library..&outdata_1.; 
by id; 
run; 
proc sort data=&library..temporary_id; 
by id; 
run; 
data &library..temp; 
merge &library..&outdata_1. &library..temporary_id; 
by id; 
run; 
data &library..temp; 
set &library..temp; 
id_shrinked=id_short; 
id_long=id;
run; 
data &library..temp; 
set &library..temp; 
drop codusu id componente; 
run; 
data &library..temp2; 
set &library..&outdata_1.; 
id_long=partner_id;
id_temp=id;
run; 
data &library..temp2; 
set &library..temp2;
keep id_long id_temp; 
run; 
data &library..temp2; 
set &library..temp2; 
if id_long='0' then delete; 
run; 
proc sort data=&library..temp; 
by id_long; run;; 
proc sort data=&library..temp2; 
by id_long; run; 
data &library..temp3; 
merge &library..temp2 &library..temp; 
by id_long; 
run; 
data &library..temp4; 
set &library..temp3; 
keep id_long id_short id_temp; 
run; 
data &library..temp4; 
set &library..temp4; 
if missing(id_temp) then delete; 
short_p_id=id_short; 
run;
data &library..temp4; 
set &library..temp4;
drop id_long; 
run; 
data &library..temp4; 
set &library..temp4; 
id_long=id_temp; 
drop id_temp; 
run; 




proc sort data=&library..temp3; 
by id_long; 
run; 

proc sort data=&library..temp4; 
by id_long; 
run; 
data &library..temp5;
merge &library..temp4 &library..temp3; 
by id_long; 
run;  
/*ENFIN! Maintenant on a l'identifiant court pour le partenaire. On va renommer tout ça pour le rendre liam2 compatible à terme*/
data &library..temp5; 
set &library..temp5; 
if missing(short_p_id) then short_p_id=-1;
drop id_temp partner_id ;  
run; 
/*Maintenant la même chose pour mother_id*/

data &library..temp2b; 
set &library..&outdata_1.; 
id_temp=id;
id_temp2=mother_id;
run; 
proc sort data=&library..temp2b; 
by id_temp2; 
run; 
data &library..temp2ab; 
set &library..temp2b; 
by id_temp2;
if last.id_temp2; 
run; 
data &library..temp2ab; 
set &library..temp2ab;
keep id_temp2 id_temp ; 
run; 
data &library..tempb; 
set &library..temp; 
id_temp2=id_long; 
run;  
proc sort data=&library..tempb; 
by id_temp2;
run; 
proc sort data=&library..temp2ab; 
by id_temp2; run; 
data &library..temp3b; 
merge &library..tempb &library..temp2ab; 
by id_temp2; 
run;
 
data &library..temp4b; 
set &library..temp3b; 
keep id_temp2  id_short ; 
run; 
data &library..temp4b; 
set &library..temp4b; 
short_m_id=id_short; 
mother_id=id_temp2;
run; 
data &library..temp4b; 
set &library..temp4b; 
drop id_short id_temp2; 
run; 
proc sort data=&library..temp4b; 
by mother_id; 
run; 
proc sort data=&library..tempb; 
by mother_id; 
run; 
data &library..temp5b;
merge &library..tempb &library..temp4b; 
by mother_id;
run;  
proc sort data=&library..temp5b; 
by id_long; 
run; 
data &library..temp5b; 
set &library..temp5b;
if missing(id_long) then delete; 
run;  
data &library..temp5b; 
set &library..temp5b; 
if missing(short_m_id) then short_m_id=-1; 
run; 




/*Et on raccourcit l'identifiant pour le père aussi*/

data &library..temp2c; 
set &library..&outdata_1.; 
id_temp=id;
id_temp2=father_id;
run; 
proc sort data=&library..temp2c; 
by id_temp2; 
run; 
data &library..temp2abc; 
set &library..temp2c; 
by id_temp2;
if last.id_temp2; 
run; 
data &library..temp2abc; 
set &library..temp2abc;
keep id_temp2 id_temp ; 
run; 
data &library..tempc; 
set &library..temp; 
id_temp2=id_long; 
run;  
proc sort data=&library..tempc; 
by id_temp2;
run; 
proc sort data=&library..temp2abc; 
by id_temp2; run; 
data &library..temp3c; 
merge &library..tempc &library..temp2abc; 
by id_temp2; 
run;
 
data &library..temp4c; 
set &library..temp3c; 
keep id_temp2  id_short ; 
run; 
data &library..temp4c; 
set &library..temp4c; 
short_f_id=id_short; 
father_id=id_temp2;
run; 
data &library..temp4c; 
set &library..temp4c; 
drop id_short id_temp2; 
run; 
proc sort data=&library..temp4c; 
by father_id; 
run; 
proc sort data=&library..tempc; 
by father_id; 
run; 
data &library..temp5c;
merge &library..tempc &library..temp4c; 
by father_id;
run;   
proc sort data=&library..temp5c; 
by id_long; 
run; 
data &library..temp5c; 
set &library..temp5c;
if missing(id_long) then delete; 
run;  
data &library..temp5c; 
set &library..temp5c; 
if missing(short_f_id) then short_f_id=-1; 
run; 
/*Maintenant on merge les bases avec les identifiants raccourcis pour les mères, les pères et les partenaires*/
proc sort data=&library..temp5; 
by id_long; 
run; 
proc sort data=&library..temp5b; 
by id_long; 
run; 

proc sort data=&library..temp5c; 
by id_long; 
run; 
data &library..&outdata_2.;
merge &library..temp5 &library..temp5b &library..temp5c; 
by id_long; 
/*et pour mother_id c'est BON! */
if missing(id_short) then delete; 
run; 
/*Maintenant on a dans notre table avec toutes les variables les différents rôles possibles dans un ménage
ainsi que des variables "identifiant du père" "identifiant de la mère" et "identifiant du concubin". 
On va maintenant préparer la base pour être traitée par liam22. */
proc sort data=&library..&outdata_2.; 
by household; 
run; 
data &library..&outdata_2.; 
set &library..&outdata_2.; 
keep household id_short id_long short_p_id short_m_id short_f_id mother_id father_id partner_id id_shrinked; 
run; 
data &library..&outdata_3._hh; 
set &library..&outdata_2.; 
by household;
if last.household; 
run; 

data household;
set &library..&outdata_2.;  
by household; 
if last.household;
run; 
proc sort data=household; 
by household; 
run; 
data household;
set household; 
by household; 
	temp+1; 
	household_short=temp-1; 
run; 
data household; 
set household; 
keep household household_short; 
ruN; 

data &library..&outdata_3._hh; 
merge &library..&outdata_3._hh household; 
by household; 
run; 
data &library..&outdata_3._hh; 
set &library..&outdata_3._hh; 
keep pondera household household_short ano4 trimestre period ;
period=&period_2.;  
run; 


proc sort data=&library..&outdata_2.; 
by household; 
run; 
data &library..&outdata_2.; 
merge &library..&outdata_2. household; 
	by household; 
	period=&period.; 
run; 
data &library..tempfua; 
set &library..&outdata_2.; 
drop household id_long mother_id partner_id father_id;  
run; 
data &library..&outdata_3.; 
set &library..tempfua; 
id=id_short; 
household=household_short; 
mother_id=short_m_id; 
partner_id=short_p_id;
father_id=short_f_id;  
run; 
/*data &library..&outdata_3.; 
set &library..tempfua; 
keep pondera agegroup labour_market_state formation hhstate ch04 id household marital_status period ano4  ch06  mother_id partner_id father_id;  
run; */
proc sort data=&library..&outdata_3.; 
by id; 
run; 
data &library..&outdata_3.; 
set &library..&outdata_3.;
period=&period.;  
run; 
data &library..&outdata_3.; 
set &library..&outdata_3.; 
by  id ;  
if first.id  then apparition=1; 
else apparition+1;
run;
data &library..&outdata_3.; 
set &library..&outdata_3.; 
if apparition ^=1 then delete; 
drop apparition; 
run; 
%mend; 
>>>>>>> 12f2b92332c8cca169e4072a1b1ee4ea607764e3
